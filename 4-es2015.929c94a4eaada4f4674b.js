(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"2dOp":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{}},"6eTy":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cpa=function(e,t){var i=(0,n.headingDistanceTo)(e.location,t.location),c=i.distance,s=i.heading,l=c*Math.sin((0,o.degToRad)(s)),d=c*Math.cos((0,o.degToRad)(s)),u={position:{x:0,y:0},vector:{x:e.speed*Math.sin((0,o.degToRad)(e.heading)),y:e.speed*Math.cos((0,o.degToRad)(e.heading))}},f={position:{x:l,y:d},vector:{x:t.speed*Math.sin((0,o.degToRad)(t.heading)),y:t.speed*Math.cos((0,o.degToRad)(t.heading))}};return{time:a(u,f),distance:r(u,f)}},t.cpaTime=a,t.cpaDistance=r;var n=i("RvDl"),o=i("9TDR");function a(e,t){var i=d(e.vector,t.vector),n=c(i,i);return n<1e-8?0:-c(d(e.position,t.position),i)/n}function r(e,t){var i=a(e,t);return function(e){return Math.sqrt(c(e,e))}(d(s(e.position,l(i,e.vector)),s(t.position,l(i,t.vector))))}function c(e,t){return e.x*t.x+e.y*t.y}function s(e,t){return{x:e.x+t.x,y:e.y+t.y}}function l(e,t){return{x:e*t.x,y:e*t.y}}function d(e,t){return{x:e.x-t.x,y:e.y-t.y}}},"9TDR":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.degToRad=function(e){return e*Math.PI/180},t.radToDeg=function(e){return 180*e/Math.PI},t.knotsToMeterPerSecond=function(e){return.514444*e},t.meterPerSecondToKnots=function(e){return e/.514444},t.knotsToKmPerHour=function(e){return 1.852*e},t.kmPerHourToKnots=function(e){return e/1.852}},"Pg/a":function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var n=i("fXoL"),o=i("3Pt+"),a=i("AA5P"),r=i("+lji"),c=i("2dOp"),s=i("JOr0"),l=i("nx09"),d=i("zOUh"),u=i("wne+"),f=i("pxUr"),h=i("bSwM"),g=i("ofXK"),b=i("kmnG"),p=i("qFsG"),m=i("QibW"),v=i("bTqV"),C=i("0IaG");const M=["search"],S=["registerForm"];function y(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"mat-form-field",3),n.Rb(2,"input",36,37),n.Zb("ngModelChange",(function(t){return n.xc(e),n.dc().dataCliente.direccion=t}))("keydown.enter",(function(t){return n.xc(e),t.preventDefault()}))("keyup",(function(){n.xc(e);const t=n.uc(3);return n.dc().checkDireccion(t.value)})),n.Qb(),n.Qb(),n.Ob()}if(2&e){const e=n.dc();n.zb(2),n.lc("ngModel",e.dataCliente.direccion)}}function R(e,t){if(1&e){const e=n.Sb();n.Rb(0,"div",9),n.Rb(1,"mat-form-field",3),n.Mb(2,"input",38,39),n.Qb(),n.Rb(4,"button",40),n.Zb("click",(function(){n.xc(e);const t=n.uc(3);return n.dc().getDirCoordenadas(t.value)})),n.Mb(5,"span",41),n.Qb(),n.Qb()}}function k(e,t){if(1&e){const e=n.Sb();n.Rb(0,"div",42),n.Rb(1,"button",43),n.Zb("click",(function(){return n.xc(e),n.dc().confirmarDireccion()})),n.Gc(2,"Confirmar"),n.Qb(),n.Qb()}}function w(e,t){1&e&&n.Nb(0)}function I(e,t){1&e&&n.Gc(0," Listo Guardar ")}function T(e,t){1&e&&(n.Pb(0),n.Mb(1,"i",45),n.Gc(2," Guardando ... "),n.Ob())}function L(e,t){1&e&&(n.Mb(0,"i",46),n.Gc(1," Hecho "))}function D(e,t){if(1&e&&(n.Ec(0,T,3,0,"ng-container",7),n.Ec(1,L,2,0,"ng-template",null,44,n.Fc)),2&e){const e=n.uc(2),t=n.dc();n.lc("ngIf",1===t.loader)("ngIfElse",e)}}function x(e,t){if(1&e){const e=n.Sb();n.Rb(0,"button",47),n.Zb("click",(function(){return n.xc(e),n.dc().recargarPage()})),n.Mb(1,"span",48),n.Gc(2," Recargar "),n.Qb()}}function Q(e,t){1&e&&(n.Rb(0,"p",49),n.Gc(1,"Indique direccion y una referencia."),n.Qb())}function O(e,t){1&e&&(n.Rb(0,"p",50),n.Gc(1,"El servicio no esta disponible en esta ubicaci\xf3n."),n.Qb())}let E=(()=>{class e{constructor(e,t,i,o,a,r,c,s,l){this.formBuilder=e,this.mapsAPILoader=t,this.ngZone=i,this.verifyClientService=o,this.crudService=a,this.miPedidoService=r,this.inforTokenService=c,this.utilService=s,this.establecimientoService=l,this.loader=0,this.dirInCoordenadas=!1,this.isUsCliente=!0,this.countMoveMap=0,this.isChangeDireccion=!0,this.checkekFirstOption=!0,this.isGuardarDireccion=!0,this.dataMaps=new n.n,this.saveDireccionOk=new n.n,this.isDireccionValid=!0,this.mapCenter={},this._componentRestrictions={country:"pe"},this.markerClicked=e=>{this.map&&this.map.setCenter({lat:e.latitude,lng:e.longitude})}}ngOnInit(){this.dataCliente=new c.a,this.inforTokenService.getInfoUs(),this.isUsCliente=this.inforTokenService.getInfoUs().isCliente,this.loadForm()}ngAfterViewInit(){this.loadInitComponent()}loadInitComponent(){this.mapsAPILoader.load().then(()=>{this.setCurrentLocation(),this.geoCoder=new google.maps.Geocoder;const e=new google.maps.places.Autocomplete(this.searchElementRef.nativeElement,{componentRestrictions:this._componentRestrictions});e.addListener("place_changed",()=>{this.ngZone.run(()=>{const t=e.getPlace();this.countMoveMap=0,this.dataMapa=t,this.address=t.formatted_address,null!=t.geometry&&(this.latitude=t.geometry.location.lat(),this.longitude=t.geometry.location.lng(),this.zoom=17,this.isChangeDireccion=!1,this.mapCenter.lat=this.latitude,this.mapCenter.lng=this.longitude,setTimeout(()=>{this.isChangeDireccion=!0},500))})})})}setCurrentLocation(){if(!1===this.isUsCliente)return this.dataInfoSede=this.miPedidoService.objDatosSede.datossede[0],this.latitude=this.dataInfoSede.latitude,this.longitude=this.dataInfoSede.longitude,void(this.zoom=17);"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{this.latitude=e.coords.latitude,this.longitude=e.coords.longitude,this.zoom=17,this.getAddress(this.latitude,this.longitude)})}markerDragEnd(e){this.latitude=e.coords.lat,this.longitude=e.coords.lng}getDirCoordenadas(e){const t=e.split(","),i=parseFloat(t[0]),n=parseFloat(t[1]);this.latitude=i,this.longitude=n,this.isChangeDireccion=!0,this.getAddress(i,n)}getAddress(e,t){this.geoCoder.geocode({location:{lat:e,lng:t}},(e,t)=>{if("OK"===t&&e[0]&&(this.zoom=17,this.address=e[0].formatted_address,this.dataMapa=e[0],this.isChangeDireccion&&(this.dataCliente.direccion=this.address),this.dirInCoordenadas&&this.registerForm.controls.direccion.patchValue(this.dataCliente.direccion),!this.isUsCliente)){const e=this.searchTypeMap("locality");this.isDireccionValid=e.toLowerCase().trim()===this.dataInfoSede.ciudad.toLowerCase().trim()}})}loadForm(){this.registerForm=this.formBuilder.group({direccion:["",o.D.required],referencia:[this.dataCliente.referencia,o.D.required],longitude:[this.longitude,o.D.required],latitude:[this.latitude,o.D.required],titulo:this.dataCliente.titulo||"Casa"}),this.registerForm.statusChanges.subscribe(e=>{"VALID"===e&&this.guardarDireccion()})}checkDireccion(e){""===e.trim()&&(this.longitude=null,this.latitude=null)}guardarDireccion(){this.isDireccionValid&&(this.dataCliente.direccion=this.address,this.dataCliente.idcliente=this.isUsCliente?this.verifyClientService.getDataClient().idcliente:this.idClienteBuscar,this.dataCliente.longitude=this.mapCenter.lng,this.dataCliente.latitude=this.mapCenter.lat,this.dataCliente.referencia=this.utilService.addslashes(this.dataCliente.referencia),this.dataCliente.ciudad=this.searchTypeMap("locality"),this.dataCliente.provincia=this.searchTypeMap("administrative_area_level_2"),this.dataCliente.departamento=this.searchTypeMap("administrative_area_level_1"),this.dataCliente.pais=this.searchTypeMap("country"),this.dataCliente.codigo=this.searchTypeMap("postal_code"))}saveDireccion(){if(this.loader=1,this.dataCliente.titulo=this.dataCliente.titulo||"Casa",!this.isGuardarDireccion)return this.loader=2,this.dataCliente.idcliente_pwa_direccion=null,void this.saveDireccionOk.emit(this.dataCliente);this.isUsCliente&&this.countMoveMap>1?(this.getAddress(this.mapCenter.lat,this.mapCenter.lng),setTimeout(()=>{this.guardarDireccion(),this.setBdDireccion()},1500)):this.setBdDireccion()}setBdDireccion(){this.dataCliente.referencia=this.utilService.addslashes(this.dataCliente.referencia),this.crudService.postFree(this.dataCliente,"cliente","new-direccion",!1).subscribe(e=>{setTimeout(()=>{this.loader=2,setTimeout(()=>{this.dataCliente.idcliente_pwa_direccion=e.data[0].idcliente_pwa_direccion,this.saveDireccionOk.emit(this.dataCliente),this.countMoveMap=1},500)},1e3)})}searchTypeMap(e){let t="";return this.dataMapa.address_components.map(i=>{i.types.map(n=>{if(n===e)return t=i.long_name,t})}),t}mapReady(e){this.map=e}idleMap(){this.countMoveMap++}centerChange(e){e&&(this.mapCenter.lat=e.lat,this.mapCenter.lng=e.lng)}clickmap(){this.isChangeDireccion=!0}confirmarDireccion(){this.countMoveMap=1,this.getAddress(this.mapCenter.lat,this.mapCenter.lng)}recargarPage(){window.location.reload()}}return e.\u0275fac=function(t){return new(t||e)(n.Lb(o.e),n.Lb(f.d),n.Lb(n.z),n.Lb(a.a),n.Lb(r.a),n.Lb(l.a),n.Lb(d.a),n.Lb(u.a),n.Lb(s.a))},e.\u0275cmp=n.Fb({type:e,selectors:[["app-agregar-direccion"]],viewQuery:function(e,t){var i;1&e&&(n.Mc(M,!0),n.Mc(S,!0),n.Mc(M,!0)),2&e&&(n.tc(i=n.ac())&&(t.searchElementRef=i.first),n.tc(i=n.ac())&&(t.myForm=i.first),n.tc(i=n.ac())&&(t.agmMap=i.first))},inputs:{idClienteBuscar:"idClienteBuscar",isGuardarDireccion:"isGuardarDireccion"},outputs:{dataMaps:"dataMaps",saveDireccionOk:"saveDireccionOk"},decls:57,vars:20,consts:[[1,"bg-warning","pt-3","pr-3","pl-3","p-1"],[1,"fs-13"],[3,"formGroup"],[1,"w-100"],[1,"p-3"],[1,"text-secondary","fw-100","fs-11"],[1,"fs-11","mt-2","text-info",3,"change"],[4,"ngIf","ngIfElse"],["elseTemplateCoordenadas",""],[1,"w-100","d-flex","justify-content-between"],["matInput","","maxlength","150","placeholder","Referencia / piso / oficina","formControlName","referencia",1,"input-headline",3,"ngModel","ngModelChange"],[1,"btn-in-input","btn","btn-sm","btn-info",3,"disabled","click"],["hidden","true"],["matInput","","placeholder","Referencia / piso / oficina","formControlName","longitude",1,"input-headline",3,"ngModel","ngModelChange"],["matInput","","placeholder","Referencia / piso / oficina","formControlName","latitude",1,"input-headline",3,"ngModel","ngModelChange"],["id","map_canvas",1,"border"],[3,"latitude","longitude","zoom","centerChange","mapClick","idle"],[1,"centerMarker"],["class","btn-confirmar-dir",4,"ngIf"],[1,"fw-600","fs-13"],[1,"fs-13",3,"ngModel","ngModelChange"],["radioGroup","matRadioGroup"],["value","Casa",1,"pr-3",3,"checked"],["value","Trabajo",1,"pr-3"],["value","Novi@",1,"pr-3"],["value","Otro",1,"pr-3"],[1,"text-center","pb-3"],["mat-flat-button","","mat-dialog-close","",1,"mr-3"],[1,"fa","fa-arrow-left"],["mat-flat-button","","color","primary",3,"disabled","click"],[4,"ngIf","ngIfThen","ngIfElse"],["thenTemplate",""],["elseTemplate",""],["class","mt-2","mat-flat-button","","color","primary",3,"click",4,"ngIf"],["class","fw-600 text-danger fs-14",4,"ngIf"],["class","fw-600 text-danger fs-16",4,"ngIf"],["matInput","","placeholder","Direccion","formControlName","direccion","autocorrect","off","autocapitalize","off","spellcheck","off","type","text","id","search",1,"input-headline",3,"ngModel","ngModelChange","keydown.enter","keyup"],["search",""],["matInput","","placeholder","Coordenadas",1,"input-headline"],["text_coordenadas",""],[1,"btn-in-input","btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-search"],[1,"btn-confirmar-dir"],[1,"btn","btn-success",3,"click"],["elseTemplateHecho",""],[1,"fa","fa-spinner","fa-spin","fa-fw"],[1,"fa","fa-check"],["mat-flat-button","","color","primary",1,"mt-2",3,"click"],[1,"fa","fa-refresh","mr-1"],[1,"fw-600","text-danger","fs-14"],[1,"fw-600","text-danger","fs-16"]],template:function(e,t){if(1&e&&(n.Rb(0,"div",0),n.Rb(1,"p",1),n.Gc(2,"Indique la direccion exacta de entrega. "),n.Rb(3,"strong"),n.Gc(4,"Se tomara como referencia el punto que especifica en el mapa."),n.Qb(),n.Qb(),n.Qb(),n.Rb(5,"div"),n.Rb(6,"form",2),n.Rb(7,"div",3),n.Rb(8,"div",4),n.Rb(9,"span",5),n.Gc(10,"Escriba el nombre de la calle numero y ciudad. No es necesario escribir: Jiron, jr, pasaje, av, etc."),n.Qb(),n.Rb(11,"div"),n.Rb(12,"mat-checkbox",6),n.Zb("change",(function(){return t.dirInCoordenadas=!t.dirInCoordenadas})),n.Gc(13,"Ingresar direccion en coordenadas: Lat, Lng."),n.Qb(),n.Qb(),n.Ec(14,y,4,1,"ng-container",7),n.Ec(15,R,6,0,"ng-template",null,8,n.Fc),n.Rb(17,"div",9),n.Rb(18,"mat-form-field",3),n.Rb(19,"input",10),n.Zb("ngModelChange",(function(e){return t.dataCliente.referencia=e})),n.Qb(),n.Qb(),n.Rb(20,"button",11),n.Zb("click",(function(){return t.saveDireccion()})),n.Gc(21,"Listo"),n.Qb(),n.Qb(),n.Rb(22,"div",12),n.Rb(23,"mat-form-field",3),n.Rb(24,"input",13),n.Zb("ngModelChange",(function(e){return t.longitude=e})),n.Qb(),n.Qb(),n.Rb(25,"mat-form-field",3),n.Rb(26,"input",14),n.Zb("ngModelChange",(function(e){return t.latitude=e})),n.Qb(),n.Qb(),n.Qb(),n.Rb(27,"div",15),n.Rb(28,"agm-map",16),n.Zb("centerChange",(function(e){return t.centerChange(e)}))("mapClick",(function(){return t.clickmap()}))("idle",(function(){return t.idleMap()})),n.Qb(),n.Mb(29,"div",17),n.Ec(30,k,3,0,"div",18),n.Qb(),n.Qb(),n.Qb(),n.Qb(),n.Rb(31,"div",4),n.Rb(32,"p",19),n.Gc(33,"Esta es la direcci\xf3n de mi:"),n.Qb(),n.Rb(34,"mat-radio-group",20,21),n.Zb("ngModelChange",(function(e){return t.dataCliente.titulo=e})),n.Rb(36,"mat-radio-button",22),n.Gc(37,"Casa"),n.Qb(),n.Rb(38,"mat-radio-button",23),n.Gc(39,"Trabajo"),n.Qb(),n.Rb(40,"mat-radio-button",24),n.Gc(41,"Novi@"),n.Qb(),n.Rb(42,"mat-radio-button",25),n.Gc(43,"Otro"),n.Qb(),n.Qb(),n.Qb(),n.Rb(44,"div",26),n.Rb(45,"button",27),n.Mb(46,"i",28),n.Gc(47," Atras "),n.Qb(),n.Rb(48,"button",29),n.Zb("click",(function(){return t.saveDireccion()})),n.Ec(49,w,1,0,"ng-container",30),n.Ec(50,I,1,0,"ng-template",null,31,n.Fc),n.Ec(52,D,3,2,"ng-template",null,32,n.Fc),n.Qb(),n.Ec(54,x,3,0,"button",33),n.Qb(),n.Ec(55,Q,2,0,"p",34),n.Ec(56,O,2,0,"p",35),n.Qb()),2&e){const e=n.uc(16),i=n.uc(51),o=n.uc(53);n.zb(6),n.lc("formGroup",t.registerForm),n.zb(8),n.lc("ngIf",!t.dirInCoordenadas)("ngIfElse",e),n.zb(5),n.lc("ngModel",t.dataCliente.referencia),n.zb(1),n.lc("disabled",!t.registerForm.valid||t.loader>0||!t.isDireccionValid),n.zb(4),n.lc("ngModel",t.longitude),n.zb(2),n.lc("ngModel",t.latitude),n.zb(2),n.lc("latitude",t.latitude)("longitude",t.longitude)("zoom",t.zoom),n.zb(2),n.lc("ngIf",t.countMoveMap>1),n.zb(4),n.lc("ngModel",t.dataCliente.titulo),n.zb(2),n.lc("checked",t.checkekFirstOption),n.zb(12),n.lc("disabled",!t.registerForm.valid||t.loader>0||!t.isDireccionValid),n.zb(1),n.lc("ngIf",0===t.loader)("ngIfThen",i)("ngIfElse",o),n.zb(5),n.lc("ngIf",!t.registerForm.valid),n.zb(1),n.lc("ngIf",!t.registerForm.valid),n.zb(1),n.lc("ngIf",!t.isDireccionValid)}},directives:[o.F,o.q,o.i,h.a,g.t,b.c,p.a,o.c,o.k,o.p,o.h,f.b,m.b,o.s,m.a,v.b,C.d],styles:["agm-map[_ngcontent-%COMP%]{height:300px}.btn-in-input[_ngcontent-%COMP%]{top:17px;position:relative;width:50px;height:30px;margin-left:10px}.input-headline[_ngcontent-%COMP%]{font-size:13px;line-height:13px}#map_canvas[_ngcontent-%COMP%]{position:relative}#map_canvas[_ngcontent-%COMP%]   .centerMarker[_ngcontent-%COMP%]{position:absolute;background:url(//maps.gstatic.com/mapfiles/markers2/marker.png) no-repeat;top:50%;left:50%;z-index:1;margin-left:-10px;margin-top:-34px;height:34px;width:20px;cursor:pointer}.btn-confirmar-dir[_ngcontent-%COMP%]{width:100%;text-align:center;position:absolute;bottom:10px}"]}),e})()},RvDl:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EARTH_RADIUS=void 0,t.isEqual=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(!e||!t)&&Math.abs(p(e)-p(t))<=i&&Math.abs(b(e)-b(t))<=i},t.isLatLon=s,t.isLatLng=l,t.isLatitudeLongitude=d,t.isLonLatTuple=u,t.getLocationType=f,t.createLocation=h,t.toLatLon=function(e){if(u(e))return{lat:e[1],lon:e[0]};if(s(e))return{lat:e.lat,lon:e.lon};if(l(e))return{lat:e.lat,lon:e.lng};if(d(e))return{lat:e.latitude,lon:e.longitude};throw new Error("Unknown location format "+JSON.stringify(e))},t.toLatLng=function(e){if(u(e))return{lat:e[1],lng:e[0]};if(s(e))return{lat:e.lat,lng:e.lon};if(l(e))return{lat:e.lat,lng:e.lng};if(d(e))return{lat:e.latitude,lng:e.longitude};throw new Error("Unknown location format "+JSON.stringify(e))},t.toLatitudeLongitude=function(e){if(u(e))return{latitude:e[1],longitude:e[0]};if(s(e))return{latitude:e.lat,longitude:e.lon};if(l(e))return{latitude:e.lat,longitude:e.lng};if(d(e))return{latitude:e.latitude,longitude:e.longitude};throw new Error("Unknown location format "+JSON.stringify(e))},t.toLonLatTuple=g,t.getLongitude=b,t.getLatitude=p,t.moveTo=m,t.headingDistanceTo=v,t.headingTo=function(e,t){return v(e,t).heading},t.distanceTo=C,t.insideBoundingBox=function(e,t){var i=p(e),n=b(e),o=b(t.topLeft),a=p(t.topLeft),r=b(t.bottomRight),c=p(t.bottomRight),s=Math.min(a,c),l=Math.max(a,c),d=Math.min(o,r),u=Math.max(o,r);return n>=d&&n<=u&&i>=s&&i<=l},t.insidePolygon=function(e,t){if(!t||!Array.isArray(t))throw new TypeError("Invalid polygon. Array with locations expected");if(0===t.length)throw new TypeError("Invalid polygon. Non-empty Array expected");return(0,o.default)(g(e),t.map(g))},t.insideCircle=function(e,t,i){return C(t,e)<=i},t.normalizeHeading=function(e){var t=e%360;return t<0&&(t+=360),t>=360&&(t-=360),t},t.normalizeLatitude=M,t.normalizeLongitude=S,t.normalizeLocation=function(e){if(u(e))return[S(e[0]),M(e[1])];if(s(e))return{lat:M(e.lat),lon:S(e.lon)};if(l(e))return{lat:M(e.lat),lng:S(e.lng)};if(d(e))return{latitude:M(e.latitude),longitude:S(e.longitude)};throw new Error("Unknown location format "+JSON.stringify(e))},t.average=function(e){if(!Array.isArray(e)||0===e.length)return null;var t=e[0];return h(y(e.map(p)),y(e.map(b)),f(t))},t.getBoundingBox=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Array.isArray(e)||0===e.length)return{topLeft:null,bottomRight:null};var i=f(e[0]),n=Math.max.apply(Math,r(e.map(p))),o=Math.min.apply(Math,r(e.map(b))),a=Math.min.apply(Math,r(e.map(p))),c=Math.max.apply(Math,r(e.map(b))),s=h(n,o,i),l=h(a,c,i);if(null===t||0===t)return{topLeft:s,bottomRight:l};var d=Math.SQRT2*t;return{topLeft:m(s,{heading:315,distance:d}),bottomRight:m(l,{heading:135,distance:d})}};var n,o=(n=i("cQc6"))&&n.__esModule?n:{default:n},a=i("9TDR");function r(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var c=t.EARTH_RADIUS=6378137;function s(e){return!!e&&"number"==typeof e.lat&&"number"==typeof e.lon}function l(e){return!!e&&"number"==typeof e.lat&&"number"==typeof e.lng}function d(e){return!!e&&"number"==typeof e.latitude&&"number"==typeof e.longitude}function u(e){return Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]}function f(e){if(u(e))return"LonLatTuple";if(s(e))return"LatLon";if(l(e))return"LatLng";if(d(e))return"LatitudeLongitude";throw new Error("Unknown location format "+JSON.stringify(e))}function h(e,t,i){if("LonLatTuple"===i)return[t,e];if("LatLon"===i)return{lat:e,lon:t};if("LatLng"===i)return{lat:e,lng:t};if("LatitudeLongitude"===i)return{latitude:e,longitude:t};throw new Error("Unknown location format "+JSON.stringify(location))}function g(e){if(u(e))return[e[0],e[1]];if(s(e))return[e.lon,e.lat];if(l(e))return[e.lng,e.lat];if(d(e))return[e.longitude,e.latitude];throw new Error("Unknown location format "+JSON.stringify(e))}function b(e){if(u(e))return e[0];if(s(e))return e.lon;if(l(e))return e.lng;if(d(e))return e.longitude;throw new Error("Unknown location format "+JSON.stringify(e))}function p(e){if(u(e))return e[1];if(s(e))return e.lat;if(l(e))return e.lat;if(d(e))return e.latitude;throw new Error("Unknown location format "+JSON.stringify(e))}function m(e,t){var i=p(e),n=b(e),o=t.heading,r=t.distance,s=r*Math.cos((0,a.degToRad)(o))/c,l=r*Math.sin((0,a.degToRad)(o))/(c*Math.cos((0,a.degToRad)(i)));return h(i+(0,a.radToDeg)(s),n+(0,a.radToDeg)(l),f(e))}function v(e,t){var i=p(e),n=b(e),o=p(t),r=b(t),s=(0,a.degToRad)(i),l=(0,a.degToRad)(o),d=(0,a.degToRad)(o-i),u=(0,a.degToRad)(r-n),f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(s)*Math.cos(l)*Math.sin(u/2)*Math.sin(u/2),h=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),g=c*h,m=Math.sin(u)*Math.cos(l),v=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(u);return{distance:g,heading:(0,a.radToDeg)(Math.atan2(m,v))}}function C(e,t){return v(e,t).distance}function M(e){return Math.asin(Math.sin(e/180*Math.PI))*(180/Math.PI)}function S(e){var t=e%360;return t>180&&(t-=360),t<=-180&&(t+=360),t}function y(e){return function(e){return e.reduce((function(e,t){return e+t}),0)}(e)/e.length}},VhxH:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("9TDR");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var o=i("RvDl");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var a=i("6eTy");Object.defineProperty(t,"cpa",{enumerable:!0,get:function(){return a.cpa}})},cQc6:function(e,t){e.exports=function(e,t){for(var i=e[0],n=e[1],o=!1,a=0,r=t.length-1;a<t.length;r=a++){var c=t[a][0],s=t[a][1],l=t[r][1];s>n!=l>n&&i<(t[r][0]-c)*(n-s)/(l-s)+c&&(o=!o)}return o}},e9Tq:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var n=i("0IaG"),o=i("+lji"),a=i("yFR0"),r=i("AA5P"),c=i("fXoL"),s=i("kmnG"),l=i("qFsG"),d=i("ofXK"),u=i("bTqV");function f(e,t){1&e&&(c.Rb(0,"p",13),c.Gc(1,"N\xfamero no valido."),c.Qb())}function h(e,t){if(1&e&&(c.Pb(0),c.Rb(1,"span",14),c.Gc(2),c.ec(3,"number"),c.Qb(),c.Gc(4," Enviando Mensaje... "),c.Ob()),2&e){const e=c.dc();c.zb(2),c.Hc(c.gc(3,1,e.numSegundosActivarBtn,"2."))}}function g(e,t){1&e&&(c.Pb(0),c.Gc(1," Enviar c\xf3digo de verificaci\xf3n "),c.Ob())}function b(e,t){1&e&&c.Gc(0," Enviar c\xf3digo nuevamente ")}function p(e,t){if(1&e&&(c.Ec(0,g,2,0,"ng-container",9),c.Ec(1,b,1,0,"ng-template",null,15,c.Fc)),2&e){const e=c.uc(2),t=c.dc();c.lc("ngIf",0===t.intentoVerificacion)("ngIfElse",e)}}function m(e,t){1&e&&(c.Pb(0),c.Gc(1," Verificar Codigo "),c.Ob())}function v(e,t){1&e&&(c.Pb(0),c.Mb(1,"i",22),c.Gc(2," Verificando ... "),c.Ob())}function C(e,t){1&e&&(c.Mb(0,"i",23),c.Gc(1," Hecho "))}function M(e,t){if(1&e&&(c.Ec(0,v,3,0,"ng-container",9),c.Ec(1,C,2,0,"ng-template",null,21,c.Fc)),2&e){const e=c.uc(2),t=c.dc(2);c.lc("ngIf",1===t.loader)("ngIfElse",e)}}function S(e,t){1&e&&(c.Rb(0,"p",24),c.Gc(1,"Codigo ingresado incorrecto."),c.Qb())}function y(e,t){if(1&e){const e=c.Sb();c.Rb(0,"div",0),c.Rb(1,"p",16),c.Gc(2,"En breve recibiras un mensaje. Escribelo el codigo aqui:"),c.Qb(),c.Rb(3,"mat-form-field",4),c.Mb(4,"input",17,18),c.Qb(),c.Mb(6,"br"),c.Rb(7,"button",8),c.Zb("click",(function(){c.xc(e);const t=c.uc(5);return c.dc().verificarCodigoSMS(t.value)})),c.Ec(8,m,2,0,"ng-container",9),c.Ec(9,M,3,2,"ng-template",null,19,c.Fc),c.Qb(),c.Ec(11,S,2,0,"p",20),c.Qb()}if(2&e){const e=c.uc(10),t=c.dc();c.zb(7),c.lc("disabled",0!==t.loader&&3!==t.loader),c.zb(1),c.lc("ngIf",0===t.loader||3===t.loader)("ngIfElse",e),c.zb(3),c.lc("ngIf",t.loader>0&&!t.isVerificacionOk)}}let R=(()=>{class e{constructor(e,t,i,n,o){var a;this.dialogRef=e,this.crudService=i,this.socketService=n,this.verifyClientService=o,this.isValidForm=!1,this.isSendSMS=!1,this.isNumberSuccess=0,this.loader=0,this.isVerificacionOk=!1,this.intentoVerificacion=0,this.numSegundosActivarBtn=15,this.isContandoShow=!1,this.isClienteNoRegister=!1,this.data=t,-1===(null===(a=this.data)||void 0===a?void 0:a.idcliente)&&(this.isClienteNoRegister=!0)}ngOnInit(){this.socketService.isSocketOpen||(this.infoClient=this.verifyClientService.getDataClient(),console.log("this.infoClient",this.infoClient),this.socketService.connect(this.infoClient,0,!1,!1)),this.socketService.onMsjVerificacionResponse().subscribe(e=>{console.log("repuesta == ",e),e.msj&&(this.intentoVerificacion=0),this.isNumberSuccess=e.msj?1:2,this.isSendSMS=!0,this.isValidForm=!1,this.isContandoShow=!1,this.detenerContadorBtnSend()})}enviarCodigoSMS(){this.isClienteNoRegister?this.buscarClienteTelefono():this.sendSMS()}sendSMS(){if(this.isVerificacionOk=!1,this.isSendSMS=!1,this.isContandoShow=!1,this.isNumberSuccess=0,this.numSegundosActivarBtn=15,0===this.intentoVerificacion)return this.data.idsocket=this.socketService.getIdSocket(),this.socketService.isSocketOpen||this.socketService.connect(this.infoClient,0,!1,!1),setTimeout(()=>{this.socketService.emit("msj-confirma-telefono",this.data)},500),this.isContandoShow=!0,void this.contadorActvarBtnSend();this.contadorActvarBtnSend(),this.crudService.postSMS(this.data,"delivery","send-sms-confirmation",!1).subscribe(e=>{this.isNumberSuccess=e.msj?1:2,this.isSendSMS=e.msj,this.isValidForm=!1,this.detenerContadorBtnSend()})}verificarCodigoSMS(e){this.loader=1,this.crudService.postFree({idcliente:this.isClienteNoRegister?-2:this.data.idcliente,codigo:e,numberphone:this.data.numberphone},"delivery","verificar-codigo-sms",!1).subscribe(e=>{this.isVerificacionOk=1===e.data[0].response,setTimeout(()=>{this.loader=this.isVerificacionOk?2:3,this.data.verificado=this.isVerificacionOk,this.isVerificacionOk&&setTimeout(()=>{this.cerrarDlg()},1e3)},1e3)})}verificarNum(e){this.isValidForm=e.trim().length>=5,this.data.numberphone=e,this.data.verificado=!1}contadorActvarBtnSend(){this.isContandoShow=!0,this.conteoInterval=setInterval(()=>{this.numSegundosActivarBtn>0?this.numSegundosActivarBtn--:(this.numSegundosActivarBtn=15,this.isSendSMS=!0,this.isContandoShow=!1,this.intentoVerificacion=1,clearInterval(this.conteoInterval))},1e3)}detenerContadorBtnSend(){this.numSegundosActivarBtn=15,this.isSendSMS=!0,this.isContandoShow=!1,clearInterval(this.conteoInterval)}buscarClienteTelefono(){this.crudService.postFree({telefono:this.data.numberphone},"delivery","search-cliente-by-phone",!1).subscribe(e=>{console.log("cliten con telefono",e),this.data.isClienteTelefono=!0,this.data.cliente=e.data.length>0?e.data[0]:null,e.data.length>0&&(this.isClienteNoRegister=!1,this.data.idcliente=this.data.cliente.idcliente),this.sendSMS()})}cerrarDlg(){this.dialogRef.close(this.data)}}return e.\u0275fac=function(t){return new(t||e)(c.Lb(n.i),c.Lb(n.a),c.Lb(o.a),c.Lb(a.a),c.Lb(r.a))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-dialog-verificar-telefono"]],decls:19,vars:6,consts:[[1,"p-4"],[1,"fs-18","fw-600"],[1,"fa","fa-arrow-left","pr-2",3,"click"],[1,"fa","fa-phone","ml-2"],[1,"w-100"],["type","number","matInput","","placeholder","Telefono","required","",3,"value","keyup"],["telefono",""],["class","text-danger",4,"ngIf"],["mat-flat-button","","color","primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["elseTemplateMsjVerificacion",""],[1,"fs-13","text-secondary","mt-1"],["class","p-4",4,"ngIf"],[1,"text-danger"],[1,"mr-2"],["elseTemplateMsjNuevamente",""],[1,"text-success","fs-600"],["type","number","matInput","","placeholder","Codigo"],["txtCodigo",""],["elseTemplate",""],["class","text-danger fw-600 pt-2",4,"ngIf"],["elseTemplateHecho",""],[1,"fa","fa-spinner","fa-spin","fa-fw"],[1,"fa","fa-check"],[1,"text-danger","fw-600","pt-2"]],template:function(e,t){if(1&e){const e=c.Sb();c.Rb(0,"div",0),c.Rb(1,"div"),c.Rb(2,"p",1),c.Rb(3,"i",2),c.Zb("click",(function(){return t.cerrarDlg()})),c.Qb(),c.Gc(4," N\xfamero de celular "),c.Mb(5,"i",3),c.Qb(),c.Qb(),c.Rb(6,"mat-form-field",4),c.Rb(7,"input",5,6),c.Zb("keyup",(function(){c.xc(e);const i=c.uc(8);return t.verificarNum(i.value)})),c.Qb(),c.Qb(),c.Ec(9,f,2,0,"p",7),c.Mb(10,"br"),c.Rb(11,"button",8),c.Zb("click",(function(){return t.enviarCodigoSMS()})),c.Ec(12,h,5,4,"ng-container",9),c.Ec(13,p,3,2,"ng-template",null,10,c.Fc),c.Qb(),c.Rb(15,"p",11),c.Gc(16,"Recibira el c\xf3digo de verificaci\xf3n por WhatsApp, sino tiene entonces recibira el c\xf3digo por SMS"),c.Qb(),c.Qb(),c.Mb(17,"hr"),c.Ec(18,y,12,4,"div",12)}if(2&e){const e=c.uc(14);c.zb(7),c.lc("value",t.data.numberphone),c.zb(2),c.lc("ngIf",2===t.isNumberSuccess),c.zb(2),c.lc("disabled",!t.isValidForm||t.isContandoShow),c.zb(1),c.lc("ngIf",t.isContandoShow)("ngIfElse",e),c.zb(6),c.lc("ngIf",t.isSendSMS)}},directives:[s.c,l.a,d.t,u.b],pipes:[d.g],styles:[""]}),e})()},lkOP:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("fXoL"),o=i("AA5P"),a=i("+lji"),r=i("0IaG"),c=i("ofXK"),s=i("FKr1");function l(e,t){if(1&e){const e=n.Sb();n.Rb(0,"li",1),n.Zb("click",(function(){n.xc(e);const i=t.$implicit;return n.dc().selected(i)})),n.Rb(1,"div",2),n.Rb(2,"p",3),n.Gc(3),n.Qb(),n.Rb(4,"p",4),n.Gc(5),n.Qb(),n.Rb(6,"p",5),n.Gc(7),n.Qb(),n.Qb(),n.Qb()}if(2&e){const e=t.$implicit;n.zb(3),n.Hc(e.titulo),n.zb(2),n.Hc(e.direccion),n.zb(2),n.Hc(e.referencia)}}let d=(()=>{class e{constructor(e,t,i){this.data=e,this.crudService=t,this.verifyClientService=i,this.direccionSelected=new n.n}ngOnInit(){this.infoClienteLogueado=this.verifyClientService.getDataClient(),this.idClienteDirecciones=this.idClienteBuscar?this.idClienteBuscar:this.infoClienteLogueado.idcliente,this.loadDireccion()}loadDireccion(){this.listDirecciones=[],this.idClienteDirecciones&&"0"!==this.idClienteDirecciones.toString()&&this.crudService.postFree({idcliente:this.idClienteDirecciones},"delivery","get-direccion-cliente",!1).subscribe(e=>{this.listDirecciones=e.data})}selected(e){this.direccionSelected.emit(e)}}return e.\u0275fac=function(t){return new(t||e)(n.Lb(r.a),n.Lb(a.a),n.Lb(o.a))},e.\u0275cmp=n.Fb({type:e,selectors:[["app-seleccionar-direccion"]],inputs:{idClienteBuscar:"idClienteBuscar"},outputs:{direccionSelected:"direccionSelected"},decls:2,vars:1,consts:[["class","li-item","matRipple","",3,"click",4,"ngFor","ngForOf"],["matRipple","",1,"li-item",3,"click"],[1,"p-3"],[1,"fw-600","fs-14"],[1,"fw-100","fs-13"],[1,"fw-600","fs-12","text-secondary"]],template:function(e,t){1&e&&(n.Rb(0,"ul"),n.Ec(1,l,8,3,"li",0),n.Qb()),2&e&&(n.zb(1),n.lc("ngForOf",t.listDirecciones))},directives:[c.s,s.n],styles:["p[_ngcontent-%COMP%]{margin-bottom:0}.li-item[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3}"]}),e})()}}]);