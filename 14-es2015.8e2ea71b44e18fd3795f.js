(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{Xg9V:function(e,t,i){"use strict";i.r(t),i.d(t,"PagarCuentaModule",(function(){return W}));var a=i("ofXK"),s=i("rsRi"),n=i("tyNb"),o=i("mrSG"),r=i("/sn2"),c=i("eI2u"),d=i("zOUh"),h=i("OzqD"),b=i("yFR0"),l=i("+lji"),p=i("zkg+"),u=i("nYx/"),m=i("wne+"),g=i("nx09"),f=i("0IaG"),P=i("W2jQ"),v=i("dDDv"),S=i("quSY"),T=i("JOr0"),k=i("7RJT"),C=i("fXoL");let y=(()=>{class e{constructor(){this.cargando_transaction=!1,this.parametros=[{user:"integraciones.visanet@necomplus.com",password:"d5e7nk$M",merchantId:"522591303",urlApiSeguridad:"https://apitestenv.vnforapps.com/api.security/v1/security",urlApiSesion:"https://apitestenv.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/",urlApiAutorization:"https://apitestenv.vnforapps.com/api.authorization/v3/authorization/ecommerce/",urlJs:"https://static-content-qas.vnforapps.com/v2/js/checkout.js?qa=true",logo:"http://web-p.test:8080/images/l-pay-2.png",Authorization:"Basic aW50ZWdyYWNpb25lcy52aXNhbmV0QG5lY29tcGx1cy5jb206ZDVlN25rJE0="},{user:"macraze.info@gmail.com",password:"j34Oz!nB",merchantId:"650149801",urlApiSeguridad:"https://apiprod.vnforapps.com/api.security/v1/security",urlApiSesion:"https://apiprod.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/",urlApiAutorization:"https://apiprod.vnforapps.com/api.authorization/v3/authorization/ecommerce/",urlJs:"https://static-content.vnforapps.com/v2/js/checkout.js",logo:"https://papaya.com.pe/images/l-pay-2.png",Authorization:"Basic bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg=="}],this.listenPaymetResponseSource=new k.BehaviorSubject(null),this.listenPaymetResponse$=this.listenPaymetResponseSource.asObservable(),this.listenPaymetLoaderSource=new k.BehaviorSubject(!1),this.listenPaymetLoader$=this.listenPaymetLoaderSource.asObservable(),this.parametrosSelected=this.parametros[1],window.addEventListener("payment.success",e=>{this.generateAutorizacion(e.detail)})}processPayment(e,t,i){this.importe=parseFloat(e).toFixed(2).toString(),this.purchasenumber=t,this.dataCliente=i,this.dataCliente.email_token=this.dataCliente.email,this.getIpCliente()}getIpCliente(){this.dataCliente.antifraud={clientIp:this.dataCliente.ip,merchantDefineData:{MDD4:this.dataCliente.email,MDD32:this.dataCliente.idcliente,MDD75:"Invitado",MDD77:this.dataCliente.diasRegistrado,MDD89:"1"}},this.generarToken()}generarToken(){fetch(this.parametrosSelected.urlApiSeguridad,{async:!0,crossDomain:!0,method:"POST",headers:{Authorization:this.parametrosSelected.Authorization,"content-type":"text/plain",Accept:"*/*"}}).then(e=>e.text()).then(e=>{this.tokenGenerate=e,this.generarSesion(e)})}generarSesion(e){const t={async:!0,crossDomain:!0,url:this.parametrosSelected.urlApiSesion+this.parametrosSelected.merchantId,method:"POST",headers:{Authorization:e,"Content-Type":"application/json"},dataMap:{userToken:this.dataCliente.email},processData:!1,body:JSON.stringify({amount:this.importe,antifraud:null,channel:"web",recurrenceMaxAmount:null})};fetch(this.parametrosSelected.urlApiSesion+this.parametrosSelected.merchantId,t).then(e=>e.json()).then(e=>{this.generarBoton(e.sessionKey)})}generarBoton(e){const t=this.dataCliente.nombre,i=this.dataCliente.apellido,a=this.dataCliente.email,s=document.createElement("form");s.setAttribute("method","post"),s.setAttribute("action","javascript:responseFormProd(self)"),s.setAttribute("id","boton_pago"),document.getElementById("btn_pago").appendChild(s);const n=document.createElement("script");n.setAttribute("src",this.parametrosSelected.urlJs),n.setAttribute("data-sessiontoken",e),n.setAttribute("data-channel","web"),n.setAttribute("data-merchantid",this.parametrosSelected.merchantId),n.setAttribute("data-purchasenumber",this.purchasenumber),n.setAttribute("data-amount",this.importe),n.setAttribute("data-merchantlogo",this.parametrosSelected.logo),n.setAttribute("data-expirationminutes","8"),n.setAttribute("data-timeouturl","javascript:responseFormProd(self)"),n.setAttribute("data-cardholdername",t),n.setAttribute("data-cardholderlastname",i),n.setAttribute("data-cardholderemail",a),n.setAttribute("data-usertoken",a),document.getElementById("boton_pago").appendChild(n),document.getElementById("btn-disabled").classList.add("btn-hidden")}generateAutorizacion(e){return Object(o.a)(this,void 0,void 0,(function*(){this.listenPaymetLoaderSource.next(!0),this.cargando_transaction=!0;const t=this.parametrosSelected.urlApiAutorization+this.parametrosSelected.merchantId,i={method:"POST",headers:{Authorization:this.tokenGenerate,"Content-Type":"application/json"},body:JSON.stringify({antifraud:this.dataCliente.antifraud,captureType:"manual",channel:"web",countable:!1,order:{amount:this.importe,currency:"PEN",purchaseNumber:this.purchasenumber,tokenId:e}})};fetch(t,i).then(e=>e.json()).then(e=>{const t=!!e.errorCode;e.error=t,this.loaderTransactionResponse(e,t),this.listenPaymetResponseSource.next(e)}).catch(e=>{e.error=!0,this.loaderTransactionResponse(e,!0),this.listenPaymetResponseSource.next(e)})}))}loaderTransactionResponse(e,t){if(e){e.error=t;const i=document.querySelector("#visaNetWrapper");i.parentNode.removeChild(i)}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=C.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var R=i("bv9b"),I=i("Wp6s"),Q=i("7EHt"),A=i("kmnG"),w=i("qFsG"),D=i("bSwM"),L=i("bTqV");function E(e,t){1&e&&(C.Qb(0,"div",7),C.Qb(1,"div"),C.Qb(2,"span"),C.Hc(3,"Verificando, un momento por favor..."),C.Pb(),C.Lb(4,"mat-progress-bar",8),C.Pb(),C.Pb())}const N=function(){return["../"]};function z(e,t){if(1&e){const e=C.Rb();C.Qb(0,"i",9),C.Yb("click",(function(){return C.wc(e),C.cc().goBack()})),C.Pb()}2&e&&C.kc("routerLink",C.oc(1,N))}const O=function(e){return{"text-danger animated flash":e}};function H(e,t){if(1&e){const e=C.Rb();C.Qb(0,"div",25),C.Qb(1,"p",26),C.Hc(2,"Se requiere un coreo para notificarle."),C.Pb(),C.Qb(3,"mat-form-field",27),C.Qb(4,"input",28,29),C.Yb("keyup",(function(){C.wc(e);const t=C.tc(5);return C.cc(2).verificarCorreo(t)})),C.Pb(),C.Pb(),C.Qb(6,"span",30),C.Hc(7,"Correo no valido"),C.Pb(),C.Lb(8,"hr"),C.Pb()}if(2&e){const e=C.cc(2);C.zb(1),C.kc("ngClass",C.pc(2,O,e.isViewAlertEmail)),C.zb(5),C.kc("hidden",e.isEmailValid)}}function _(e,t){1&e&&(C.Qb(0,"p",34),C.Hc(1,"Acepte los terminos."),C.Pb())}function x(e,t){if(1&e){const e=C.Rb();C.Qb(0,"div",13),C.Qb(1,"mat-checkbox",31),C.Yb("click",(function(){return C.wc(e),C.cc(2).goPagar()})),C.Hc(2,"Acepto los "),C.Qb(3,"a",32),C.Hc(4,"Terminos y condiciones"),C.Pb(),C.Pb(),C.Fc(5,_,2,0,"p",33),C.Lb(6,"hr"),C.Pb()}if(2&e){const e=C.cc(2);C.zb(5),C.kc("ngIf",e.isViewAlertTerminos)}}function M(e,t){if(1&e){const e=C.Rb();C.Qb(0,"div",10),C.Qb(1,"div",11),C.Qb(2,"mat-card",12),C.Qb(3,"div",13),C.Qb(4,"p"),C.Hc(5,"Importe a pagar:"),C.Pb(),C.Qb(6,"div"),C.Qb(7,"p",14),C.Qb(8,"span",15),C.Hc(9),C.Pb(),C.Qb(10,"span",16),C.Hc(11),C.dc(12,"number"),C.Pb(),C.Pb(),C.Pb(),C.Lb(13,"hr"),C.Fc(14,H,9,4,"div",17),C.Fc(15,x,7,1,"div",18),C.Qb(16,"div",19),C.Lb(17,"div",20),C.Qb(18,"div",21),C.Yb("click",(function(){return C.wc(e),C.cc().verificarCheckTerminos()})),C.Lb(19,"span",22),C.Qb(20,"span",23),C.Hc(21,"Pagar Aqui"),C.Pb(),C.Pb(),C.Pb(),C.Pb(),C.Pb(),C.Qb(22,"mat-accordion"),C.Qb(23,"mat-expansion-panel"),C.Qb(24,"mat-expansion-panel-header"),C.Qb(25,"mat-panel-title"),C.Hc(26," Datos de Facturaci\xf3n "),C.Pb(),C.Pb(),C.Qb(27,"span",24),C.Hc(28,"Muy pronto podr\xe1s obtener tu comprobante de consumo por este medio. Por el momento lo puede solicitar en caja."),C.Pb(),C.Pb(),C.Pb(),C.Pb(),C.Pb()}if(2&e){const e=C.cc();C.zb(9),C.Ic(e.simbolo_moneda),C.zb(2),C.Ic(C.fc(12,6,e.estadoPedido.importe,"0.2")),C.zb(3),C.kc("ngIf",e.isRequiredEmail),C.zb(1),C.kc("ngIf",e.isDisabledCheck&&e.isEmailValid),C.zb(4),C.kc("hidden",!e.isLoadBtnPago),C.zb(1),C.kc("hidden",e.isLoadBtnPago)}}function F(e,t){if(1&e){const e=C.Rb();C.Ob(0),C.Qb(1,"div",38),C.Lb(2,"i",39),C.Qb(3,"p"),C.Hc(4,"Ups! hubo un problema."),C.Pb(),C.Pb(),C.Qb(5,"div",40),C.Qb(6,"div",13),C.Qb(7,"span",41),C.Hc(8),C.Lb(9,"br"),C.Hc(10),C.Lb(11,"br"),C.Hc(12),C.Lb(13,"br"),C.Pb(),C.Pb(),C.Pb(),C.Qb(14,"div",40),C.Qb(15,"div",13),C.Qb(16,"button",42),C.Yb("click",(function(){return C.wc(e),C.cc(2).actionAfterTransaction()})),C.Hc(17,"Regresar"),C.Pb(),C.Pb(),C.Pb(),C.Nb()}if(2&e){const e=C.cc(2);C.zb(8),C.Jc(" ",e.dataResTransaction.errorMessage," "),C.zb(2),C.Jc(" ",e.dataResTransaction.data.ACTION_DESCRIPTION," "),C.zb(2),C.Jc(" ",e.dataResTransaction.data.CARD," ")}}function j(e,t){if(1&e){const e=C.Rb();C.Ob(0),C.Qb(1,"div",45),C.Lb(2,"i",46),C.Qb(3,"p",47),C.Hc(4,"Transacci\xf3n Existosa."),C.Pb(),C.Pb(),C.Qb(5,"div",40),C.Qb(6,"div",13),C.Qb(7,"span",41),C.Hc(8),C.Pb(),C.Pb(),C.Pb(),C.Qb(9,"div",48),C.Qb(10,"div",49),C.Qb(11,"table"),C.Qb(12,"tr"),C.Qb(13,"td"),C.Hc(14,"Fecha"),C.Pb(),C.Qb(15,"td"),C.Hc(16),C.dc(17,"date"),C.Pb(),C.Pb(),C.Qb(18,"tr"),C.Qb(19,"td"),C.Hc(20,"N\xb0 Pedido"),C.Pb(),C.Qb(21,"td"),C.Hc(22),C.Pb(),C.Pb(),C.Qb(23,"tr"),C.Qb(24,"td"),C.Hc(25,"N\xb0 Tarjeta"),C.Pb(),C.Qb(26,"td"),C.Hc(27),C.Pb(),C.Pb(),C.Qb(28,"tr"),C.Qb(29,"td"),C.Hc(30,"Descripcion"),C.Pb(),C.Qb(31,"td"),C.Hc(32,": Pago de cuenta"),C.Pb(),C.Pb(),C.Qb(33,"tr"),C.Qb(34,"td"),C.Hc(35,"Mesa"),C.Pb(),C.Qb(36,"td"),C.Hc(37),C.Pb(),C.Pb(),C.Qb(38,"tr"),C.Qb(39,"td"),C.Hc(40,"Importe"),C.Pb(),C.Qb(41,"td"),C.Hc(42),C.dc(43,"number"),C.Pb(),C.Pb(),C.Pb(),C.Pb(),C.Pb(),C.Qb(44,"div",50),C.Qb(45,"button",51),C.Yb("click",(function(){return C.wc(e),C.cc(3).actionAfterTransaction()})),C.Hc(46," Listo "),C.Pb(),C.Lb(47,"br"),C.Pb(),C.Nb()}if(2&e){const e=C.cc(3);C.zb(8),C.Jc(" ",e.dataResTransaction.dataMap.ACTION_DESCRIPTION," "),C.zb(8),C.Jc(": ",C.fc(17,7,e.fechaTransaction,"dd/mm/yy h:mm:ss a"),""),C.zb(6),C.Jc(": ",e.dataResTransaction.order.purchaseNumber,""),C.zb(5),C.Jc(": ",e.dataResTransaction.dataMap.CARD,""),C.zb(10),C.Jc(": ",e.infoToken.numMesaLector,""),C.zb(5),C.Kc(": ",C.fc(43,10,e.estadoPedido.importe,"0.2")," ",e.dataResTransaction.order.currency,"")}}function B(e,t){1&e&&(C.Ob(0),C.Qb(1,"p",53),C.Hc(2,"Transacci\xf3n Existosa."),C.Pb(),C.Nb())}function J(e,t){1&e&&(C.Qb(0,"p"),C.Hc(1,"Listo."),C.Pb())}function V(e,t){if(1&e&&(C.Qb(0,"div",45),C.Lb(1,"i",46),C.Fc(2,B,3,0,"ng-container",36),C.Fc(3,J,2,0,"ng-template",null,52,C.Gc),C.Pb()),2&e){const e=C.tc(4),t=C.cc(3);C.zb(2),C.kc("ngIf",!t.pagaConEefectivo)("ngIfElse",e)}}function K(e,t){if(1&e){const e=C.Rb();C.Qb(0,"div"),C.Qb(1,"div",40),C.Qb(2,"div",13),C.Qb(3,"p",54),C.Hc(4,"Pedido Confirmado"),C.Pb(),C.Lb(5,"hr"),C.Qb(6,"p"),C.Hc(7,"Su orden llegara pronto."),C.Pb(),C.Lb(8,"hr"),C.Lb(9,"img",55),C.Lb(10,"hr"),C.Qb(11,"p"),C.Hc(12,"Puede ver el estado de este en "),C.Lb(13,"br"),C.Qb(14,"strong"),C.Hc(15,"Mis Pedidos"),C.Pb(),C.Hc(16,"."),C.Pb(),C.Pb(),C.Pb(),C.Qb(17,"div",50),C.Qb(18,"button",51),C.Yb("click",(function(){return C.wc(e),C.cc(3).finDelivery()})),C.Hc(19," Listo. "),C.Pb(),C.Lb(20,"br"),C.Pb(),C.Pb()}}function q(e,t){if(1&e&&(C.Fc(0,j,48,13,"ng-container",36),C.Fc(1,V,5,2,"ng-template",null,43,C.Gc),C.Fc(3,K,21,0,"div",44)),2&e){const e=C.tc(2),t=C.cc(2);C.kc("ngIf",!t.infoToken.isDelivery)("ngIfElse",e),C.zb(3),C.kc("ngIf",t.infoToken.isDelivery)}}function G(e,t){if(1&e&&(C.Qb(0,"div",35),C.Fc(1,F,18,3,"ng-container",36),C.Fc(2,q,4,3,"ng-template",null,37,C.Gc),C.Pb()),2&e){const e=C.tc(3),t=C.cc();C.zb(1),C.kc("ngIf",t.dataResTransaction.error)("ngIfElse",e)}}const Y=[{path:"",component:(()=>{class e{constructor(e,t,i,a,s,n,o,r,c,d,h,b,l){this.infoTokenService=e,this.navigatorService=t,this.listenStatusService=i,this.estadoPedidoClienteService=a,this.socketService=s,this.crudService=n,this.registrarPagoService=o,this.utilService=r,this.miPedidoService=c,this.dialog=d,this.pushNotificationSerice=h,this.establecimientoServices=b,this.pagoTarjetaServices=l,this.estadoPedido=[],this.isLoaderTransaction=!1,this.isLoadBtnPago=!1,this.isCheckTerminos=!1,this.isTrasctionSuccess=!1,this.isViewAlertTerminos=!1,this.isViewAlertEmail=!1,this.isEmailValid=!0,this.isDisabledCheck=!1,this.isRequiredEmail=!1,this.dataResTransaction=null,this.pagaConEefectivo=!1,this.countFin=6,this.intervalConteo=null,this.fechaTransaction=new Date,this.listenKeyLoader="sys::transaction-load",this.listenKeyData="sys::transaction-response",this.unsubscribeEstado=new S.a,this.dataClientePago=new p.a}ngOnInit(){if(this.navigatorService.disableGoBack(),this.infoToken=this.infoTokenService.getInfoUs(),this.simbolo_moneda=this.establecimientoServices.getSimboloMoneda(),this.infoToken.metodoPagoSelected=this.infoToken.metodoPagoSelected?this.infoToken.metodoPagoSelected:this.infoToken.metodoPago,this.pagaConEefectivo=2!==this.infoToken.metodoPagoSelected.idtipo_pago,this.isTrasctionSuccess=this.pagaConEefectivo,this.infoTokenService.infoUsToken.isPagoSuccess){if(this.infoTokenService.isDelivery())return void this.finDelivery();this.actionAfterTransaction()}this.pagaConEefectivo&&(this.dataResTransaction={error:!1},this.infoTokenService.setIsPagoSuccess(!0)),this.listener(),this.getEmailCliente()}ngOnDestroy(){this.unsubscribeEstado.unsubscribe()}listener(){return Object(o.a)(this,void 0,void 0,(function*(){let e;this.infoToken.isDelivery?(e=JSON.parse(atob(localStorage.getItem("sys::st"))),this.estadoPedido.importe=parseFloat(e[e.length-1].importe),0===this.estadoPedido.importe&&(e=JSON.parse(atob(this.infoToken.importeDelivery)),this.estadoPedido.importe=parseFloat(e[e.length-1].importe))):this.estadoPedido.importe=yield this.estadoPedidoClienteService.getImporteCuenta(),0!==this.estadoPedido.importe&&null!==this.estadoPedido.importe||this.cerrarSession(),this.socketService.connect(),localStorage.setItem("sys::btnP","0"),this.pagoTarjetaServices.listenPaymetResponse$.subscribe(e=>{e&&this.listenResponsePayment(e)}),this.pagoTarjetaServices.listenPaymetLoader$.subscribe(e=>{this.isLoaderTransaction=e})}))}cerrarSession(){this.navigatorService.cerrarSession(this.isCheckTerminos),this.infoTokenService.cerrarSession(),this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection()}getEmailCliente(){this.crudService.postFree({id:this.infoToken.idcliente},"transaction","get-email-client",!1).subscribe(e=>{this.dataClientePago.email=e.data[0].correo?e.data[0].correo:"",this.isRequiredEmail=""===this.dataClientePago.email,this.isEmailValid=!this.isRequiredEmail,this.dataClientePago.isSaveEmail=this.isRequiredEmail,this.dataClientePago.idcliente=e.data[0].idcliente_card,this.dataClientePago.diasRegistrado=e.data[0].dias_registrado,this.dataClientePago.nombres=this.infoToken.nombres,this.dataClientePago.ip=this.infoToken.ipCliente,this.dataClientePago.ip?this.isDisabledCheck=!0:this.crudService.getFree("https://api.ipify.org?format=json").subscribe(e=>{this.dataClientePago.ip=e.ip,this.infoTokenService.setLocalIpCliente(this.dataClientePago.ip),this.isDisabledCheck=!0}),this.getNomApClientePago(this.dataClientePago.nombres)})}getNomApClientePago(e){const t=e.split(" ");let i="",a="";switch(t.length){case 1:i=t[0];break;case 2:i=t[0],a=t[1];break;case 3:case 4:i=t[0],a=t[2]}this.dataClientePago.nombre=this.utilService.primeraConMayusculas(i),this.dataClientePago.apellido=this.utilService.primeraConMayusculas(a)}goPagar(){if(this.isViewAlertEmail=!1,this.isViewAlertTerminos=!1,this.isCheckTerminos=!this.isCheckTerminos,!this.isCheckTerminos||!this.isEmailValid)return this.isViewAlertEmail=!0,void(this.isViewAlertTerminos=!0);this.isLoadBtnPago=!0,this.generarPurchasenumber()}goBack(){this.navigatorService.disabledBack=!1,this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection(),this.navigatorService._router("../pedido")}generarPurchasenumber(){this.crudService.getAll("transaction","get-purchasenumber",!1,!1,!1).subscribe(e=>{const t=e.data[0].purchasenumber;this.el_purchasenumber=t,this.pagoTarjetaServices.processPayment(this.estadoPedido.importe,t,this.dataClientePago),this.verificarCheckTerminos(),this.listenStatusService.setIsBtnPagoShow(!0),localStorage.setItem("sys::btnP","1")})}listenResponse(){this.timeListenerKeys=setInterval(()=>{const e=localStorage.getItem(this.listenKeyData);let t;if(this.isLoaderTransaction="0"!==localStorage.getItem(this.listenKeyLoader),"null"!==e){if(clearInterval(this.timeListenerKeys),this.isLoadBtnPago=!1,this.dataResTransaction=JSON.parse(e),this.isTrasctionSuccess=!this.dataResTransaction.error,this.isTrasctionSuccess)if(t={purchaseNumber:this.dataResTransaction.order.purchaseNumber,card:this.dataResTransaction.dataMap.CARD,brand:this.dataResTransaction.dataMap.BRAND,descripcion:this.dataResTransaction.dataMap.ACTION_DESCRIPTION,status:this.dataResTransaction.dataMap.STATUS,error:this.dataResTransaction.error},this.infoToken.isDelivery){this.isLoaderTransaction=!0;const e=JSON.parse(atob(this.infoToken.orderDelivery));this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago,!0).subscribe(t=>{e.dataPedido.p_header.idregistro_pago=t,this.socketService.emitRes("nuevoPedido",e).subscribe(t=>{!1===t&&this.crudService.postFree(JSON.stringify(e),"pedido","registrar-nuevo-pedido",!1).subscribe(e=>{console.log("pedido registrado")})}),setTimeout(()=>{this.isLoaderTransaction=!1,this.infoTokenService.setIsPagoSuccess(!0)},1900)})}else this.infoTokenService.setIsPagoSuccess(!0),this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago).subscribe(e=>{});else t={purchaseNumber:this.el_purchasenumber,card:this.dataResTransaction.data.CARD,brand:this.dataResTransaction.data.BRAND,descripcion:this.dataResTransaction.data.ACTION_DESCRIPTION,status:this.dataResTransaction.data.STATUS,error:this.dataResTransaction.error},this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago).subscribe(e=>{});localStorage.removeItem(this.listenKeyData)}},900)}listenResponsePayment(e){let t;if(this.dataResTransaction=e,this.isLoaderTransaction=!0,this.isTrasctionSuccess=!this.dataResTransaction.error,this.isTrasctionSuccess)if(t={purchaseNumber:this.dataResTransaction.order.purchaseNumber,card:this.dataResTransaction.dataMap.CARD,brand:this.dataResTransaction.dataMap.BRAND,descripcion:this.dataResTransaction.dataMap.ACTION_DESCRIPTION,status:this.dataResTransaction.dataMap.STATUS,error:this.dataResTransaction.error},this.infoToken.isDelivery){this.isLoaderTransaction=!0;const e=JSON.parse(atob(this.infoToken.orderDelivery));this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago,!0).subscribe(t=>{e.dataPedido.p_header.idregistro_pago=t,this.socketService.emitRes("nuevoPedido",e).subscribe(t=>{!1===t&&this.crudService.postFree(JSON.stringify(e),"pedido","registrar-nuevo-pedido",!1).subscribe(e=>{console.log("pedido registrado")})}),setTimeout(()=>{this.isLoaderTransaction=!1,this.infoTokenService.setIsPagoSuccess(!0),setTimeout(()=>{this.finDelivery()},6e3)},1900)})}else this.infoTokenService.setIsPagoSuccess(!0),this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago).subscribe(e=>{this.isLoaderTransaction=!1});else t={purchaseNumber:this.el_purchasenumber,card:this.dataResTransaction.data.CARD,brand:this.dataResTransaction.data.BRAND,descripcion:this.dataResTransaction.data.ACTION_DESCRIPTION,status:this.dataResTransaction.data.STATUS,error:this.dataResTransaction.error},this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),t,this.dataClientePago).subscribe(e=>{this.isLoaderTransaction=!1})}verificarCheckTerminos(){this.isViewAlertTerminos=!this.isCheckTerminos,this.isViewAlertEmail=!this.isEmailValid}verificarCorreo(e){this.isEmailValid=e.checkValidity(),this.isViewAlertEmail=!this.isEmailValid,this.dataClientePago.email=e.value}cuentaRegresiva(){this.countFin<=0?(this.intervalConteo=null,this.actionAfterTransaction()):this.conteoFinEncuesta()}conteoFinEncuesta(){this.intervalConteo=setTimeout(()=>{this.countFin--,this.cuentaRegresiva()},1e3)}actionAfterTransaction(){this.dataResTransaction&&(this.dataResTransaction.error?this.navigatorService._router("../pedido"):this.infoToken.isSoloLLevar?this.goBack():this.navigatorService._router("../lanzar-encuesta")),this.miPedidoService.prepareNewPedido()}finDelivery(){this.lanzarPermisoNotificationPush(0),this.miPedidoService.prepareNewPedido(),this.infoTokenService.cerrarSession(),this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection(),this.dataResTransaction=null,this.navigatorService.__router("../zona-delivery")}lanzarPermisoNotificationPush(e=0){if(this.pushNotificationSerice.getIsTienePermiso())return void this.pushNotificationSerice.suscribirse();const t=new f.e;t.disableClose=!0,t.hasBackdrop=!0,t.data={idMjs:e},this.dialog.open(P.a,t).afterClosed().subscribe(e=>{e&&this.pushNotificationSerice.suscribirse()})}}return e.\u0275fac=function(t){return new(t||e)(C.Kb(d.a),C.Kb(r.a),C.Kb(c.a),C.Kb(h.a),C.Kb(b.a),C.Kb(l.a),C.Kb(u.a),C.Kb(m.a),C.Kb(g.a),C.Kb(f.b),C.Kb(v.a),C.Kb(T.a),C.Kb(y))},e.\u0275cmp=C.Eb({type:e,selectors:[["app-pagar-cuenta"]],decls:8,vars:5,consts:[["class","loader-pago",4,"ngIf"],[1,"animated","fadeIn","content-pago"],[1,"header-pago","p-3"],["class","fa fa-arrow-left",3,"routerLink","click",4,"ngIf"],[1,"pl-2"],["class","animated fadeInUp",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"loader-pago"],["mode","indeterminate"],[1,"fa","fa-arrow-left",3,"routerLink","click"],[1,"animated","fadeInUp"],[1,"p-3",2,"max-width","500px","margin","0 auto"],[1,"mt-2","mb-2"],[1,"text-center"],[1,"fs-30","fw-600"],[1,"fs-15"],["id","importe"],["class","w-100",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"div-btn"],["id","btn_pago"],["id","btn-disabled",1,"btn-pago-disabled",3,"click"],[1,"fa","fa-spinner","fa-spin",3,"hidden"],[3,"hidden"],[1,"fw-100","text-secondary"],[1,"w-100"],["ng","",1,"fs-13","fw-100",3,"ngClass"],[1,"w-100","text-center"],["matInput","","type","email","name","email","pattern","[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$","placeholder","Correo electronico",1,"text-center",3,"keyup"],["txtCorreo",""],[1,"fs-13","fw-100","text-danger","m-0","p-0",3,"hidden"],[3,"click"],["href","http://papaya.com.pe/terminos-condiciones.html","target","_blank"],["class","fw-100 fs-14 text-danger animated flash",4,"ngIf"],[1,"fw-100","fs-14","text-danger","animated","flash"],[1,"animated","fadeIn"],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"text-center","fs-20","fw-100","banner-res-error","p-3"],["aria-hidden","true",1,"fa","fa-times-circle-o","fa-2x"],[1,"p-3","bg-white"],[1,"fw-100"],["mat-flat-button","","color","accent",3,"click"],["esClienteDelivery",""],[4,"ngIf"],[1,"text-center","fs-20","fw-100","banner-res-ok","p-3"],["aria-hidden","true",1,"fa","fa-check-circle-o","fa-2x"],[1,"t-e-n"],[1,"p-3"],[1,"text-left","fw-100"],[1,"p-3","bg-white","text-center"],["mat-flat-button","","color","primary",3,"click"],["divPagoEfectivo",""],[1,"t-e"],[1,"fs-20"],["src","./assets/images/food_delivery.gif","alt","delivery","width","160px"]],template:function(e,t){1&e&&(C.Fc(0,E,5,0,"div",0),C.Qb(1,"div",1),C.Qb(2,"div",2),C.Fc(3,z,1,2,"i",3),C.Qb(4,"span",4),C.Hc(5),C.Pb(),C.Pb(),C.Fc(6,M,29,9,"div",5),C.Fc(7,G,4,2,"div",6),C.Pb()),2&e&&(C.kc("ngIf",t.isLoaderTransaction),C.zb(3),C.kc("ngIf",!t.isTrasctionSuccess),C.zb(2),C.Jc("Pagar con ",t.infoToken.metodoPago.descripcion,""),C.zb(1),C.kc("ngIf",!t.dataResTransaction),C.zb(1),C.kc("ngIf",t.dataResTransaction))},directives:[a.t,R.a,n.e,I.a,Q.a,Q.c,Q.g,Q.h,a.q,A.c,w.a,D.a,L.b],pipes:[a.g,a.f],styles:[".content-pago[_ngcontent-%COMP%]{height:100vh;background:#e5eff7}.header-pago[_ngcontent-%COMP%]{background:#3f51b5;color:#fff;width:100%}.loader-pago[_ngcontent-%COMP%]{position:absolute;z-index:1;height:100vh;text-align:center;vertical-align:middle;background:#212121;width:100%;opacity:.9;color:#fff}.loader-pago[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{top:50%}.btn-pago-disabled[_ngcontent-%COMP%], .loader-pago[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:50%;margin:0 auto}.btn-pago-disabled[_ngcontent-%COMP%]{-webkit-transition:all 1s ease-in-out;transition:all 1s ease-in-out;background:grey;border-radius:5px;padding:8px;color:#fff;text-align:center}.btn-hidden[_ngcontent-%COMP%]{display:none}.div-btn[_ngcontent-%COMP%]{height:48px}.banner-res-ok[_ngcontent-%COMP%]{color:#fff;background:#436be1}.banner-res-error[_ngcontent-%COMP%]{color:#fff;background:#ef5350}"]}),e})(),data:{titulo:"Cuenta"},children:[{path:"",redirectTo:"pagar-cuenta"},{path:"pago-res",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=C.Eb({type:e,selectors:[["app-pago-respuesta"]],decls:2,vars:0,template:function(e,t){1&e&&(C.Qb(0,"p"),C.Hc(1,"pago-respuesta works!"),C.Pb())},styles:[""]}),e})()},{path:"pedido-confirmado",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=C.Eb({type:e,selectors:[["app-pedido-confirmado-msj"]],decls:5,vars:0,consts:[[1,"h-100",2,"background-color","#3f51b5"],[1,"mt-2","mb-2"],[1,"p-3",2,"max-width","500px","margin","0 auto"]],template:function(e,t){1&e&&(C.Qb(0,"div",0),C.Qb(1,"mat-card",1),C.Qb(2,"div",2),C.Qb(3,"p"),C.Hc(4,"Pedido confirmado"),C.Pb(),C.Pb(),C.Pb(),C.Pb())},directives:[I.a],styles:[""]}),e})()}]}];let U=(()=>{class e{}return e.\u0275mod=C.Ib({type:e}),e.\u0275inj=C.Hb({factory:function(t){return new(t||e)},imports:[[n.h.forChild(Y)],n.h]}),e})(),W=(()=>{class e{}return e.\u0275mod=C.Ib({type:e}),e.\u0275inj=C.Hb({factory:function(t){return new(t||e)},imports:[[a.c,U,s.a]]}),e})()},"zkg+":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));class a{}}}]);