(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{Xg9V:function(e,i,t){"use strict";t.r(i),t.d(i,"PagarCuentaModule",(function(){return K}));var a=t("ofXK"),s=t("rsRi"),n=t("tyNb"),o=t("mrSG"),r=t("/sn2"),c=t("eI2u"),d=t("zOUh"),b=t("OzqD"),l=t("yFR0"),h=t("+lji");class f{}var p=t("nYx/"),g=t("wne+"),u=t("nx09"),m=t("0IaG"),v=t("W2jQ"),C=t("dDDv"),R=t("quSY"),T=t("fXoL"),S=t("bv9b"),P=t("Wp6s"),k=t("7EHt"),Q=t("kmnG"),I=t("qFsG"),w=t("bSwM"),y=t("bTqV");function E(e,i){1&e&&(T.Rb(0,"div",7),T.Rb(1,"div"),T.Rb(2,"span"),T.Cc(3,"Verificando, un momento por favor..."),T.Qb(),T.Mb(4,"mat-progress-bar",8),T.Qb(),T.Qb())}const M=function(){return["../"]};function A(e,i){if(1&e){const e=T.Sb();T.Rb(0,"i",9),T.Yb("click",(function(){return T.uc(e),T.cc().goBack()})),T.Qb()}2&e&&T.ic("routerLink",T.mc(1,M))}const L=function(e){return{"text-danger animated flash":e}};function O(e,i){if(1&e){const e=T.Sb();T.Rb(0,"div",25),T.Rb(1,"p",26),T.Cc(2,"Se requiere un coreo para notificarle."),T.Qb(),T.Rb(3,"mat-form-field",27),T.Rb(4,"input",28,29),T.Yb("keyup",(function(){T.uc(e);const i=T.rc(5);return T.cc(2).verificarCorreo(i)})),T.Qb(),T.Qb(),T.Rb(6,"span",30),T.Cc(7,"Correo no valido"),T.Qb(),T.Mb(8,"hr"),T.Qb()}if(2&e){const e=T.cc(2);T.zb(1),T.ic("ngClass",T.nc(2,L,e.isViewAlertEmail)),T.zb(5),T.ic("hidden",e.isEmailValid)}}function z(e,i){1&e&&(T.Rb(0,"p",34),T.Cc(1,"Acepte los terminos."),T.Qb())}function D(e,i){if(1&e){const e=T.Sb();T.Rb(0,"div",13),T.Rb(1,"mat-checkbox",31),T.Yb("click",(function(){return T.uc(e),T.cc(2).goPagar()})),T.Cc(2,"Acepto los "),T.Rb(3,"a",32),T.Cc(4,"Terminos y condiciones"),T.Qb(),T.Qb(),T.Ac(5,z,2,0,"p",33),T.Mb(6,"hr"),T.Qb()}if(2&e){const e=T.cc(2);T.zb(5),T.ic("ngIf",e.isViewAlertTerminos)}}function x(e,i){if(1&e){const e=T.Sb();T.Rb(0,"div",10),T.Rb(1,"div",11),T.Rb(2,"mat-card",12),T.Rb(3,"div",13),T.Rb(4,"p"),T.Cc(5,"Importe a pagar:"),T.Qb(),T.Rb(6,"div"),T.Rb(7,"p",14),T.Rb(8,"span",15),T.Cc(9,"S/."),T.Qb(),T.Rb(10,"span",16),T.Cc(11),T.dc(12,"number"),T.Qb(),T.Qb(),T.Qb(),T.Mb(13,"hr"),T.Ac(14,O,9,4,"div",17),T.Ac(15,D,7,1,"div",18),T.Rb(16,"div",19),T.Mb(17,"div",20),T.Rb(18,"div",21),T.Yb("click",(function(){return T.uc(e),T.cc().verificarCheckTerminos()})),T.Mb(19,"span",22),T.Rb(20,"span",23),T.Cc(21,"Pagar Aqui"),T.Qb(),T.Qb(),T.Qb(),T.Qb(),T.Qb(),T.Rb(22,"mat-accordion"),T.Rb(23,"mat-expansion-panel"),T.Rb(24,"mat-expansion-panel-header"),T.Rb(25,"mat-panel-title"),T.Cc(26," Datos de Facturaci\xf3n "),T.Qb(),T.Qb(),T.Rb(27,"span",24),T.Cc(28,"Muy pronto podr\xe1s obtener tu comprobante de consumo por este medio. Por el momento lo puede solicitar en caja."),T.Qb(),T.Qb(),T.Qb(),T.Qb(),T.Qb()}if(2&e){const e=T.cc();T.zb(11),T.Dc(T.fc(12,5,e.estadoPedido.importe,"0.2")),T.zb(3),T.ic("ngIf",e.isRequiredEmail),T.zb(1),T.ic("ngIf",e.isDisabledCheck&&e.isEmailValid),T.zb(4),T.ic("hidden",!e.isLoadBtnPago),T.zb(1),T.ic("hidden",e.isLoadBtnPago)}}function N(e,i){if(1&e){const e=T.Sb();T.Pb(0),T.Rb(1,"div",38),T.Mb(2,"i",39),T.Rb(3,"p"),T.Cc(4,"Ups! hubo un problema."),T.Qb(),T.Qb(),T.Rb(5,"div",40),T.Rb(6,"div",13),T.Rb(7,"span",41),T.Cc(8),T.Mb(9,"br"),T.Cc(10),T.Mb(11,"br"),T.Cc(12),T.Mb(13,"br"),T.Qb(),T.Qb(),T.Qb(),T.Rb(14,"div",40),T.Rb(15,"div",13),T.Rb(16,"button",42),T.Yb("click",(function(){return T.uc(e),T.cc(2).actionAfterTransaction()})),T.Cc(17,"Regresar"),T.Qb(),T.Qb(),T.Qb(),T.Ob()}if(2&e){const e=T.cc(2);T.zb(8),T.Ec(" ",e.dataResTransaction.errorMessage," "),T.zb(2),T.Ec(" ",e.dataResTransaction.data.ACTION_DESCRIPTION," "),T.zb(2),T.Ec(" ",e.dataResTransaction.data.CARD," ")}}function _(e,i){if(1&e&&(T.Pb(0),T.Rb(1,"div",47),T.Mb(2,"i",48),T.Rb(3,"p"),T.Cc(4,"Transacci\xf3n Existosa."),T.Qb(),T.Qb(),T.Rb(5,"div",40),T.Rb(6,"div",13),T.Rb(7,"span",41),T.Cc(8),T.Qb(),T.Qb(),T.Qb(),T.Rb(9,"div",49),T.Rb(10,"div",50),T.Rb(11,"table"),T.Rb(12,"tr"),T.Rb(13,"td"),T.Cc(14,"Fecha"),T.Qb(),T.Rb(15,"td"),T.Cc(16),T.dc(17,"date"),T.Qb(),T.Qb(),T.Rb(18,"tr"),T.Rb(19,"td"),T.Cc(20,"N\xb0 Pedido"),T.Qb(),T.Rb(21,"td"),T.Cc(22),T.Qb(),T.Qb(),T.Rb(23,"tr"),T.Rb(24,"td"),T.Cc(25,"N\xb0 Tarjeta"),T.Qb(),T.Rb(26,"td"),T.Cc(27),T.Qb(),T.Qb(),T.Rb(28,"tr"),T.Rb(29,"td"),T.Cc(30,"Descripcion"),T.Qb(),T.Rb(31,"td"),T.Cc(32,": Pago de cuenta"),T.Qb(),T.Qb(),T.Rb(33,"tr"),T.Rb(34,"td"),T.Cc(35,"Mesa"),T.Qb(),T.Rb(36,"td"),T.Cc(37),T.Qb(),T.Qb(),T.Rb(38,"tr"),T.Rb(39,"td"),T.Cc(40,"Importe"),T.Qb(),T.Rb(41,"td"),T.Cc(42),T.dc(43,"number"),T.Qb(),T.Qb(),T.Qb(),T.Qb(),T.Qb(),T.Ob()),2&e){const e=T.cc(3);T.zb(8),T.Ec(" ",e.dataResTransaction.dataMap.ACTION_DESCRIPTION," "),T.zb(8),T.Ec(": ",T.fc(17,7,e.fechaTransaction,"dd/mm/yy h:mm:ss a"),""),T.zb(6),T.Ec(": ",e.dataResTransaction.order.purchaseNumber,""),T.zb(5),T.Ec(": ",e.dataResTransaction.dataMap.CARD,""),T.zb(10),T.Ec(": ",e.infoToken.numMesaLector,""),T.zb(5),T.Fc(": ",T.fc(43,10,e.estadoPedido.importe,"0.2")," ",e.dataResTransaction.order.currency,"")}}function V(e,i){1&e&&T.Nb(0)}function B(e,i){1&e&&(T.Rb(0,"p"),T.Cc(1,"Listo."),T.Qb())}function F(e,i){if(1&e&&(T.Rb(0,"div",47),T.Mb(1,"i",48),T.Ac(2,V,1,0,"ng-container",36),T.Rb(3,"p"),T.Cc(4,"Transacci\xf3n Existosa."),T.Qb(),T.Ac(5,B,2,0,"ng-template",null,51,T.Bc),T.Qb()),2&e){const e=T.rc(6),i=T.cc(3);T.zb(2),T.ic("ngIf",!i.pagaConEefectivo)("ngIfElse",e)}}function q(e,i){if(1&e){const e=T.Sb();T.Ac(0,_,44,13,"ng-container",36),T.Ac(1,F,7,2,"ng-template",null,43,T.Bc),T.Rb(3,"div",40),T.Rb(4,"div",13),T.Rb(5,"p",44),T.Cc(6,"Pedido Confirmado"),T.Qb(),T.Mb(7,"hr"),T.Rb(8,"p"),T.Cc(9,"Su orden llegara pronto."),T.Qb(),T.Mb(10,"hr"),T.Mb(11,"img",45),T.Mb(12,"hr"),T.Rb(13,"p"),T.Cc(14,"Puede ver el estado de este en "),T.Mb(15,"br"),T.Rb(16,"strong"),T.Cc(17,"Mis Pedidos"),T.Qb(),T.Cc(18,"."),T.Qb(),T.Rb(19,"button",46),T.Yb("click",(function(){return T.uc(e),T.cc(2).finDelivery()})),T.Cc(20," Listo. "),T.Qb(),T.Mb(21,"br"),T.Qb(),T.Qb()}if(2&e){const e=T.rc(2),i=T.cc(2);T.ic("ngIf",!i.infoToken.isDelivery)("ngIfElse",e)}}function j(e,i){if(1&e&&(T.Rb(0,"div",35),T.Ac(1,N,18,3,"ng-container",36),T.Ac(2,q,22,2,"ng-template",null,37,T.Bc),T.Qb()),2&e){const e=T.rc(3),i=T.cc();T.zb(1),T.ic("ngIf",i.dataResTransaction.error)("ngIfElse",e)}}const U=[{path:"",component:(()=>{class e{constructor(e,i,t,a,s,n,o,r,c,d,b){this.infoTokenService=e,this.navigatorService=i,this.listenStatusService=t,this.estadoPedidoClienteService=a,this.socketService=s,this.crudService=n,this.registrarPagoService=o,this.utilService=r,this.miPedidoService=c,this.dialog=d,this.pushNotificationSerice=b,this.estadoPedido=[],this.isLoaderTransaction=!1,this.isLoadBtnPago=!1,this.isCheckTerminos=!1,this.isTrasctionSuccess=!1,this.isViewAlertTerminos=!1,this.isViewAlertEmail=!1,this.isEmailValid=!0,this.isDisabledCheck=!1,this.isRequiredEmail=!1,this.dataResTransaction=null,this.pagaConEefectivo=!1,this.countFin=6,this.intervalConteo=null,this.fechaTransaction=new Date,this.listenKeyLoader="sys::transaction-load",this.listenKeyData="sys::transaction-response",this.unsubscribeEstado=new R.a,this.dataClientePago=new f}ngOnInit(){this.navigatorService.disableGoBack(),this.infoToken=this.infoTokenService.getInfoUs(),this.pagaConEefectivo=2!==this.infoToken.metodoPago.idtipo_pago,this.isTrasctionSuccess=this.pagaConEefectivo,this.pagaConEefectivo&&(this.dataResTransaction={error:!1}),this.infoTokenService.infoUsToken.isPagoSuccess&&(this.infoTokenService.isDelivery()?this.finDelivery():this.actionAfterTransaction()),this.listener(),this.getEmailCliente()}ngOnDestroy(){this.unsubscribeEstado.unsubscribe()}listener(){return Object(o.a)(this,void 0,void 0,(function*(){let e;this.infoToken.isDelivery?(e=JSON.parse(atob(localStorage.getItem("sys::st"))),this.estadoPedido.importe=parseFloat(e[e.length-1].importe)):this.estadoPedido.importe=yield this.estadoPedidoClienteService.getImporteCuenta(),0!==this.estadoPedido.importe&&null!==this.estadoPedido.importe||this.cerrarSession(),this.socketService.connect(),localStorage.setItem("sys::btnP","0")}))}cerrarSession(){this.navigatorService.cerrarSession(this.isCheckTerminos),this.infoTokenService.cerrarSession(),this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection()}getEmailCliente(){this.crudService.postFree({id:this.infoToken.idcliente},"transaction","get-email-client",!1).subscribe(e=>{this.dataClientePago.email=e.data[0].correo?e.data[0].correo:"",this.isRequiredEmail=""===this.dataClientePago.email,this.isEmailValid=!this.isRequiredEmail,this.dataClientePago.isSaveEmail=this.isRequiredEmail,this.dataClientePago.idcliente=e.data[0].idcliente_card,this.dataClientePago.diasRegistrado=e.data[0].dias_registrado,this.dataClientePago.nombres=this.infoToken.nombres,this.dataClientePago.ip=this.infoToken.ipCliente,this.dataClientePago.ip?this.isDisabledCheck=!0:this.crudService.getFree("https://api.ipify.org?format=json").subscribe(e=>{this.dataClientePago.ip=e.ip,this.infoTokenService.setLocalIpCliente(this.dataClientePago.ip),this.isDisabledCheck=!0}),this.getNomApClientePago(this.dataClientePago.nombres)})}getNomApClientePago(e){const i=e.split(" ");let t="",a="";switch(i.length){case 1:t=i[0];break;case 2:t=i[0],a=i[1];break;case 3:case 4:t=i[0],a=i[2]}this.dataClientePago.nombre=this.utilService.primeraConMayusculas(t),this.dataClientePago.apellido=this.utilService.primeraConMayusculas(a)}goPagar(){if(this.isViewAlertEmail=!1,this.isViewAlertTerminos=!1,this.isCheckTerminos=!this.isCheckTerminos,!this.isCheckTerminos||!this.isEmailValid)return this.isViewAlertEmail=!0,void(this.isViewAlertTerminos=!0);this.isLoadBtnPago=!0,this.generarPurchasenumber()}goBack(){this.navigatorService.disabledBack=!1,this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection(),this.navigatorService._router("../pedido")}generarPurchasenumber(){this.crudService.getAll("transaction","get-purchasenumber",!1,!1,!1).subscribe(e=>{const i=e.data[0].purchasenumber;this.el_purchasenumber=i,pagar(this.estadoPedido.importe,i,this.dataClientePago),this.listenResponse(),this.verificarCheckTerminos(),this.listenStatusService.setIsBtnPagoShow(!0),localStorage.setItem("sys::btnP","1")})}listenResponse(){this.timeListenerKeys=setTimeout(()=>{const e=localStorage.getItem(this.listenKeyData);let i;if(this.isLoaderTransaction="0"!==localStorage.getItem(this.listenKeyLoader),"null"!==e)if(this.isLoadBtnPago=!1,this.dataResTransaction=JSON.parse(e),this.isTrasctionSuccess=!this.dataResTransaction.error,this.isTrasctionSuccess)if(i={purchaseNumber:this.dataResTransaction.order.purchaseNumber,card:this.dataResTransaction.dataMap.CARD,brand:this.dataResTransaction.dataMap.BRAND,descripcion:this.dataResTransaction.dataMap.ACTION_DESCRIPTION,status:this.dataResTransaction.dataMap.STATUS,error:this.dataResTransaction.error},this.infoToken.isDelivery){this.isLoaderTransaction=!0;const e=JSON.parse(atob(this.infoToken.orderDelivery));this.socketService.emit("nuevoPedido",e),this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),i,this.dataClientePago,!0),setTimeout(()=>{this.isLoaderTransaction=!1,this.infoTokenService.setIsPagoSuccess(!0)},1900)}else this.infoTokenService.setIsPagoSuccess(!0),this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),i,this.dataClientePago);else i={purchaseNumber:this.el_purchasenumber,card:this.dataResTransaction.data.CARD,brand:this.dataResTransaction.data.BRAND,descripcion:this.dataResTransaction.data.ACTION_DESCRIPTION,status:this.dataResTransaction.data.STATUS,error:this.dataResTransaction.error},this.registrarPagoService.registrarPago(this.estadoPedido.importe.toString(),i,this.dataClientePago);else this.listenResponse()},100)}verificarCheckTerminos(){this.isViewAlertTerminos=!this.isCheckTerminos,this.isViewAlertEmail=!this.isEmailValid}verificarCorreo(e){this.isEmailValid=e.checkValidity(),this.isViewAlertEmail=!this.isEmailValid,this.dataClientePago.email=e.value}cuentaRegresiva(){this.countFin<=0?(this.intervalConteo=null,this.actionAfterTransaction()):this.conteoFinEncuesta()}conteoFinEncuesta(){this.intervalConteo=setTimeout(()=>{this.countFin--,this.cuentaRegresiva()},1e3)}actionAfterTransaction(){this.lanzarPermisoNotificationPush(1),this.dataResTransaction.error?this.navigatorService._router("../pedido"):this.infoToken.isSoloLLevar?this.goBack():this.navigatorService._router("../lanzar-encuesta")}finDelivery(){this.lanzarPermisoNotificationPush(0),this.miPedidoService.prepareNewPedido(),this.infoTokenService.cerrarSession(),this.socketService.isSocketOpenReconect=!0,this.socketService.closeConnection(),this.navigatorService._router("../zona-delivery")}lanzarPermisoNotificationPush(e=0){if(this.pushNotificationSerice.getIsTienePermiso())return void this.pushNotificationSerice.suscribirse();const i=new m.d;i.disableClose=!0,i.hasBackdrop=!0,i.data={idMjs:e},this.dialog.open(v.a,i).afterClosed().subscribe(e=>{e&&this.pushNotificationSerice.suscribirse()})}}return e.\u0275fac=function(i){return new(i||e)(T.Lb(d.a),T.Lb(r.a),T.Lb(c.a),T.Lb(b.a),T.Lb(l.a),T.Lb(h.a),T.Lb(p.a),T.Lb(g.a),T.Lb(u.a),T.Lb(m.b),T.Lb(C.a))},e.\u0275cmp=T.Fb({type:e,selectors:[["app-pagar-cuenta"]],decls:8,vars:5,consts:[["class","loader-pago",4,"ngIf"],[1,"animated","fadeIn","content-pago"],[1,"header-pago","p-3"],["class","fa fa-arrow-left",3,"routerLink","click",4,"ngIf"],[1,"pl-2"],["class","animated fadeInUp",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"loader-pago"],["mode","indeterminate"],[1,"fa","fa-arrow-left",3,"routerLink","click"],[1,"animated","fadeInUp"],[1,"p-3",2,"max-width","500px","margin","0 auto"],[1,"mt-2","mb-2"],[1,"text-center"],[1,"fs-30","fw-600"],[1,"fs-15"],["id","importe"],["class","w-100",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"div-btn"],["id","btn_pago"],["id","btn-disabled",1,"btn-pago-disabled",3,"click"],[1,"fa","fa-spinner","fa-spin",3,"hidden"],[3,"hidden"],[1,"fw-100","text-secondary"],[1,"w-100"],["ng","",1,"fs-13","fw-100",3,"ngClass"],[1,"w-100","text-center"],["matInput","","type","email","name","email","pattern","[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$","placeholder","Correo electronico",1,"text-center",3,"keyup"],["txtCorreo",""],[1,"fs-13","fw-100","text-danger","m-0","p-0",3,"hidden"],[3,"click"],["href","http://papaya.com.pe/terminos-condiciones.html","target","_blank"],["class","fw-100 fs-14 text-danger animated flash",4,"ngIf"],[1,"fw-100","fs-14","text-danger","animated","flash"],[1,"animated","fadeIn"],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"text-center","fs-20","fw-100","banner-res-error","p-3"],["aria-hidden","true",1,"fa","fa-times-circle-o","fa-2x"],[1,"p-3","bg-white"],[1,"fw-100"],["mat-flat-button","","color","accent",3,"click"],["esClienteDelivery",""],[1,"fs-20"],["src","./assets/images/food_delivery.gif","alt","delivery","width","160px"],["mat-flat-button","","color","primary",3,"click"],[1,"text-center","fs-20","fw-100","banner-res-ok","p-3"],["aria-hidden","true",1,"fa","fa-check-circle-o","fa-2x"],[1,"p-3"],[1,"text-left","fw-100"],["divPagoEfectivo",""]],template:function(e,i){1&e&&(T.Ac(0,E,5,0,"div",0),T.Rb(1,"div",1),T.Rb(2,"div",2),T.Ac(3,A,1,2,"i",3),T.Rb(4,"span",4),T.Cc(5),T.Qb(),T.Qb(),T.Ac(6,x,29,8,"div",5),T.Ac(7,j,4,2,"div",6),T.Qb()),2&e&&(T.ic("ngIf",i.isLoaderTransaction),T.zb(3),T.ic("ngIf",!i.isTrasctionSuccess),T.zb(2),T.Ec("Pagar con ",i.infoToken.metodoPago.descripcion,""),T.zb(1),T.ic("ngIf",!i.dataResTransaction),T.zb(1),T.ic("ngIf",i.dataResTransaction))},directives:[a.n,S.a,n.e,P.a,k.a,k.c,k.d,k.e,a.l,Q.b,I.a,w.a,y.a],pipes:[a.f,a.e],styles:[".content-pago[_ngcontent-%COMP%]{height:100vh;background:#e5eff7}.header-pago[_ngcontent-%COMP%]{background:#3f51b5;color:#fff;width:100%}.loader-pago[_ngcontent-%COMP%]{position:absolute;z-index:1;height:100vh;text-align:center;vertical-align:middle;background:#212121;width:100%;opacity:.9;color:#fff}.loader-pago[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{top:50%}.btn-pago-disabled[_ngcontent-%COMP%], .loader-pago[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:50%;margin:0 auto}.btn-pago-disabled[_ngcontent-%COMP%]{transition:all 1s ease-in-out;background:grey;border-radius:5px;padding:8px;color:#fff;text-align:center}.btn-hidden[_ngcontent-%COMP%]{display:none}.div-btn[_ngcontent-%COMP%]{height:48px}.banner-res-ok[_ngcontent-%COMP%]{color:#fff;background:#436be1}.banner-res-error[_ngcontent-%COMP%]{color:#fff;background:#ef5350}"]}),e})(),data:{titulo:"Cuenta"},children:[{path:"",redirectTo:"pagar-cuenta"},{path:"pago-res",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=T.Fb({type:e,selectors:[["app-pago-respuesta"]],decls:2,vars:0,template:function(e,i){1&e&&(T.Rb(0,"p"),T.Cc(1,"pago-respuesta works!"),T.Qb())},styles:[""]}),e})()}]}];let Y=(()=>{class e{}return e.\u0275mod=T.Jb({type:e}),e.\u0275inj=T.Ib({factory:function(i){return new(i||e)},imports:[[n.g.forChild(U)],n.g]}),e})();var J=t("lSLK");let K=(()=>{class e{}return e.\u0275mod=T.Jb({type:e}),e.\u0275inj=T.Ib({factory:function(i){return new(i||e)},imports:[[a.c,Y,s.a,J.a]]}),e})()}}]);