var importe,purchasenumber,dataCliente,tokenGenerate,cargando_transaction=!1,user="macraze.info@gmail.com",password="j34Oz!nB",merchantId="650149801",urlApiSeguridad="https://apiprod.vnforapps.com/api.security/v1/security",urlApiSesion="https://apiprod.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/",urlApiAutorization="https://apiprod.vnforapps.com/api.authorization/v3/authorization/ecommerce/",urlJs="https://static-content.vnforapps.com/v2/js/checkout.js",logo="https://papaya.com.pe/images/l-pay-2.png",generarTockenAuthorization="Basic bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg==";function pagar(e,t,a){importe=parseFloat(e).toFixed(2).toString(),purchasenumber=t,(dataCliente=a).email_token=dataCliente.email,loaderTransaction(0),loaderTransactionResponse(null,!1),getIpCliente()}function getIpCliente(){dataCliente.antifraud={clientIp:dataCliente.ip,merchantDefineData:{MDD4:dataCliente.email,MDD32:dataCliente.idcliente,MDD75:"Invitado",MDD77:dataCliente.diasRegistrado,MDD89:"1"}},generarToken()}function generarToken(){$.ajax({async:!0,crossDomain:!0,url:urlApiSeguridad,method:"POST",headers:{Authorization:generarTockenAuthorization,Accept:"*/*"}}).done((function(e){console.log(e),tokenGenerate=e,generarSesion(e),localStorage.setItem("token",e)}))}function generarSesion(e){var t={async:!0,crossDomain:!0,url:urlApiSesion+merchantId,method:"POST",headers:{Authorization:e,"Content-Type":"application/json"},dataMap:{userToken:dataCliente.email},processData:!1,data:JSON.stringify({amount:importe,antifraud:null,channel:"web",recurrenceMaxAmount:null})};$.ajax(t).done((function(e){console.log("response",e),generarBoton(e.sessionKey)}))}function generarBoton(e){var t=dataCliente.nombre,a=dataCliente.apellido,n=dataCliente.email;localStorage.setItem("data",JSON.stringify({merchantId:merchantId,moneda:"PEN",nombre:t,apellido:a,importe:importe,email:n}));var o=document.createElement("form");o.setAttribute("method","post"),o.setAttribute("action","javascript:responseForm(self)"),o.setAttribute("id","boton_pago"),document.getElementById("btn_pago").appendChild(o);var r=document.createElement("script");r.setAttribute("src",urlJs),r.setAttribute("data-sessiontoken",e),r.setAttribute("data-channel","web"),r.setAttribute("data-merchantid",merchantId),r.setAttribute("data-purchasenumber",purchasenumber),r.setAttribute("data-amount",importe),r.setAttribute("data-merchantlogo",logo),r.setAttribute("data-expirationminutes",8),r.setAttribute("data-timeouturl","javascript:responseForm(self)"),r.setAttribute("data-cardholdername",t),r.setAttribute("data-cardholderlastname",a),r.setAttribute("data-cardholderemail",n),r.setAttribute("data-usertoken",n),document.getElementById("boton_pago").appendChild(r),document.getElementById("btn-disabled").classList.add("btn-hidden")}function responseForm(e){console.log("respuesta event",e),console.log("respuesta",e.message.args[0]),loaderTransaction(1),transactionToken=this.message.args[0].token,console.log("transactionToken",transactionToken),generateAutorizacion(transactionToken)}function generateAutorizacion(e){cargando_transaction=!0;var t=tokenGenerate,a={antifraud:dataCliente.antifraud,captureType:"manual",channel:"web",countable:!1,order:{amount:importe,currency:"PEN",purchaseNumber:purchasenumber,tokenId:e}},n=urlApiAutorization+merchantId;console.log("data",a),console.log("_url",n),fetch(n,{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{console.log(e);var t=!!e.errorCode;loaderTransaction(0),loaderTransactionResponse(e,t),resPayment({res:e,error:t})}).catch(e=>{console.log("error",e),loaderTransaction(0),loaderTransactionResponse(e,!0),resPayment({res:e,error:!0})})}function resPayment(e){const t=new CustomEvent("payment.success",{detail:e,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}function loaderTransaction(e){localStorage.setItem("sys::transaction-load",e)}function loaderTransactionResponse(e,t){if(console.log(e),e){e.error=t;var a=document.querySelector("#visaNetWrapper");a.parentNode.removeChild(a)}localStorage.setItem("sys::transaction-response",JSON.stringify(e))}function responseFormProd(e){loaderTransaction(1),transactionToken=this.message.args[0].token;const t=new CustomEvent("payment.success",{detail:transactionToken,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}