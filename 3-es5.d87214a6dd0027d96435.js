function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"3ui4":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function e(){_classCallCheck(this,e),this.secciones=[]}},"6NNB":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function e(){_classCallCheck(this,e),this.tipoconsumo=[]}},Ie24:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function e(){_classCallCheck(this,e),this.descuento=null,this.items=[]}},JOr0:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("qTE5"),o=i("+lji"),s=i("fXoL"),a=function(){var e=function(){function e(t){_classCallCheck(this,e),this.crudService=t,this.keyStorage="sys::ed"}return _createClass(e,[{key:"set",value:function(e){localStorage.setItem(this.keyStorage,btoa(JSON.stringify(e)))}},{key:"get",value:function(){var e=new n.a,t=localStorage.getItem(this.keyStorage);return e=t?JSON.parse(atob(t)):e}},{key:"setRulesSubtotales",value:function(e){this.establecimiento=this.get(),this.establecimiento.rulesSubTotales=e,this.set(this.establecimiento)}},{key:"setCostoSercioDelivery",value:function(e){this.establecimiento=this.get(),this.establecimiento.costo_total_servicio_delivery=e,this.set(this.establecimiento)}},{key:"loadEstablecimientoById",value:function(e){var t=this;this.crudService.postFree({idsede:e},"delivery","get-establecimientos").subscribe((function(e){t.establecimiento=e.data[0],t.set(t.establecimiento)}))}},{key:"getEstableciminetosCache",value:function(){var e=localStorage.getItem("sys:ech");return e?JSON.parse(atob(e)):[]}},{key:"setEstableciminetosCache",value:function(e){localStorage.setItem("sys:ech",btoa(JSON.stringify(e)))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(s.Vb(o.a))},e.\u0275prov=s.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},Te6q:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function e(){_classCallCheck(this,e),this.precio_total=0,this.precio_antes=null,this.cantidad_seleccionada_x_tpc=0,this.cantidad_descontado=0,this.itemtiposconsumo=[],this.subitems_selected=[],this.subitems_view=[]}},WF5t:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("7RJT"),o=i("zOUh"),s=i("fXoL"),a=function(){var e=function(){function e(t){_classCallCheck(this,e),this.infoToken=t,this.countdownTimerRef=null,this.init=0,this.valPorcentaje=0,this.isPlayTimer=!1,this.dateNow=new Date,this.countdownSource=new n.BehaviorSubject(0),this.countdown$=this.countdownSource.asObservable(),this.isTimeLimitSource=new n.BehaviorSubject(!1),this.isTimeLimitComplet$=this.isTimeLimitSource.asObservable(),this.isPorgressVisibleSource=new n.BehaviorSubject(!1),this.isPorgressVisible$=this.isPorgressVisibleSource.asObservable()}return _createClass(e,[{key:"destroy",value:function(){this.clearTimeout()}},{key:"playCountTimerLimit",value:function(){this.infoToken.isDelivery()||this.isPlayTimer||(this.isPlayTimer=!0,this.initCount())}},{key:"resetCountTimerLimit",value:function(){this.infoToken.isDelivery()||(localStorage.getItem("sys::tcount")?(this.isPlayTimer=!0,this.initCount()):this.stopCountTimerLimit())}},{key:"initCount",value:function(){this.infoToken.isDelivery()||(this.valPorcentaje=0,this.init=localStorage.getItem("sys::tcount")?parseInt(localStorage.getItem("sys::tcount"),0):0,this.isTimeLimitSource.next(!1),this.isPorgressVisibleSource.next(!0),this.progressCount())}},{key:"progressCount",value:function(){var e=this,t=0;this.isPlayTimer&&(this.countdownTimerRef=setTimeout((function(){e.init=e.setTimeDate(),e.valPorcentaje=Math.round(e.init/e.maxTime*100),localStorage.setItem("sys::tcount",e.init.toString()),e.init>e.maxTime?(e.init=e.maxTime,e.valPorcentaje=100,e.countdownSource.next(e.valPorcentaje),e.isTimeLimitSource.next(!0),e.stopCountTimerLimit()):(t!==e.valPorcentaje&&e.countdownSource.next(e.valPorcentaje),e.progressCount()),t=e.valPorcentaje}),1e3))}},{key:"setTimeDate",value:function(){var e=(new Date).getTime(),t=localStorage.getItem("sys::tnum")?parseInt(localStorage.getItem("sys::tnum"),0):e,i=Math.floor((e-t)/1e3);return localStorage.setItem("sys::tnum",t.toString()),i}},{key:"stopCountTimerLimit",value:function(){this.isPlayTimer=!1,this.init=0,this.valPorcentaje=0,localStorage.removeItem("sys::tcount"),localStorage.removeItem("sys::tnum"),this.clearTimeout(),this.isPorgressVisibleSource.next(!1),this.isTimeLimitSource.next(!1)}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.countdownTimerRef&&(clearTimeout(this.countdownTimerRef),this.countdownTimerRef=null)}))}]),e}();return e.\u0275fac=function(t){return new(t||e)(s.Vb(o.a))},e.\u0275prov=s.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},fbMX:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("fXoL"),o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"set",value:function(e,t){localStorage.setItem(e,t)}},{key:"get",value:function(e){return localStorage.getItem(e)}},{key:"isExistKey",value:function(e){return!!localStorage.getItem(e)}},{key:"clear",value:function(e){localStorage.removeItem(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},nx09:function(e,t,i){"use strict";i.d(t,"a",(function(){return I}));var n,o=i("7RJT"),s=i("Te6q"),a=i("6NNB"),c=function e(){_classCallCheck(this,e)},r=i("Ie24"),u=i("3ui4"),d=i("fbMX"),m=i("yFR0"),l=i("WF5t"),p=i("/sn2"),f=i("wne+"),v=i("eI2u"),h=function e(){_classCallCheck(this,e),this.isTpcLocal=!1,this.isTpcSoloLLevar=!1,this.isTpcSoloDelivery=!1,this.isTpcSoloOther=!1,this.isRequiereMesa=!1},S=function e(){_classCallCheck(this,e)},b=i("JOr0"),_=i("+lji"),y=i("zOUh"),g=i("fXoL"),C=i("dNgK"),I=((n=function(){function e(t,i,n,c,u,d,m,l,p,f){_classCallCheck(this,e),this.storageService=t,this.socketService=i,this.timerLimitService=n,this.navigatorService=c,this._snackBar=u,this.utilesService=d,this.listenStatusService=m,this.establecimientoService=l,this.crudService=p,this.infoTokenService=f,this.miPedidoSource=new o.BehaviorSubject(new a.a),this.miPedidoObserver$=this.miPedidoSource.asObservable(),this.countItemsSource=new o.BehaviorSubject(0),this.countItemsObserve$=this.countItemsSource.asObservable(),this.itemStockChangeSource=new o.BehaviorSubject(new s.a),this.itemStockChangeObserve$=this.itemStockChangeSource.asObservable(),this.isPreAvisoVisible=!1,this.listItemsPedido=[],this.miPedido=new a.a,this.mpObjSeccionSelected=new r.a,this.time=new Date,this.pwa_delivery_servicio_propio=!1,this.deliveryCanItemsInOrder=0,this.deliveryArrConstantes={cantItemsScala:0,costoScala:0}}return _createClass(e,[{key:"getObjCarta",value:function(){return this.objCarta}},{key:"getObjCartaLibery",value:function(){return JSON.parse(JSON.stringify(this.objCarta))}},{key:"setObjMiPedido",value:function(e){this.miPedido=e,this.miPedidoSource.next(this.miPedido)}},{key:"resetObjMiPedido",value:function(){this.miPedido=new a.a,this.miPedidoSource.next(this.miPedido)}},{key:"setObjCarta",value:function(e){this.objCarta={},this.objCarta={carta:null,bodega:null},this.objCarta.carta=e[0].carta,this.objCarta.bodega=e[0].bodega;var t=this.objCarta.carta,i=this.objCarta.bodega;if(i){if(!this.objCarta.carta){var n=new c;return n.des="Productos",n.detalle="",n.hora_fin="",n.hora_ini="",n.idcarta=0,n.idcategoria=0,n.secciones=[],(t=[]).push(n),t.map((function(e){i.map((function(t){e.secciones.push(t)}))})),void(this.objCarta.carta=t)}t.map((function(e){i.map((function(t){e.secciones.push(t)}))}))}}},{key:"setObjCartaDescuentos",value:function(e){var t=this;if(this.infoTokenService.infoUsToken.isHayDescuento=!1,0!==e.length&&(1!==e[0].solo_app||this.infoTokenService.infoUsToken.isCliente)){this.infoTokenService.infoUsToken.isHayDescuento=!0;var i=0;e.map((function(e){switch(e.tipo){case 0:t.objCarta.carta.map((function(n){n.secciones.map((function(n){var o=n.items.filter((function(t){return t.iditem.toString()===e.id}))[0];if(o)return i=e.porcentaje,o.iddescuento=e.idsede_descuento,t.aplicarDescuentoImte(o,i),!1}))}));break;case 1:i=e.porcentaje,t.objCarta.carta.map((function(n){n.secciones.map((function(n){n.idseccion.toString()===e.id&&(n.descuento=i+"%",n.iddescuento=e.idsede_descuento,n.items.map((function(e){t.aplicarDescuentoImte(e,i)})))}))}));break;case 2:i=e.porcentaje,t.objCarta.bodega.map((function(n){var o=n.items.filter((function(t){return t.iditem.toString()===e.id}))[0];if(o)return i=e.porcentaje,o.iddescuento=e.idsede_descuento,t.aplicarDescuentoImte(o,i),!1}));break;case 3:i=e.porcentaje,t.objCarta.bodega.map((function(n){n.idseccion.toString()===e.id&&(n.descuento=i+"%",n.iddescuento=e.idsede_descuento,n.items.map((function(e){t.aplicarDescuentoImte(e,i)})))}))}}))}}},{key:"aplicarDescuentoImte",value:function(e,t){var i=parseFloat(e.precio),n=Math.round(i-i*(t/100));e.precio_antes=e.precio,e.precio=n.toString(),e.precio_default=n,e.precio_unitario=n.toString()}},{key:"getIdsDescuentos",value:function(){var e,t=[];return this.miPedido.tipoconsumo.map((function(i){i.secciones.map((function(i){(e=i.iddescuento)&&(t.filter((function(t){return t.id===e}))[0]||t.push({id:e})),i.items.map((function(n){(e=i.iddescuento)&&(t.filter((function(t){return t.id===e}))[0]||t.push({id:e}))}))}))})),t}},{key:"getMiPedido",value:function(){return 0===this.miPedido.tipoconsumo.length&&this.storageService.isExistKey("sys::order::all")&&(this.miPedido=JSON.parse(atob(this.storageService.get("sys::order::all")))),this.miPedido}},{key:"setobjItemTipoConsumoSelected",value:function(e){this.mpObjItemTipoConsumoSelected=e}},{key:"setObjSeccionSeleced",value:function(e){this.mpObjSeccionSelected=new r.a,this.mpObjSeccionSelected.des=e.des,this.mpObjSeccionSelected.idimpresora=e.idimpresora,this.mpObjSeccionSelected.idseccion=e.idseccion,this.mpObjSeccionSelected.sec_orden=e.sec_orden,this.mpObjSeccionSelected.ver_stock_cero=e.ver_stock_cero,this.mpObjSeccionSelected.iddescuento=e.iddescuento,this.mpObjSeccionSelected.descuento=e.descuento}},{key:"getDeliveryConstCantEscala",value:function(){var e=this,t=localStorage.getItem("sys::ICS");t?this.deliveryArrConstantes=JSON.parse(atob(t)):this.crudService.getAll("pedido","get-const-delivery-items-escala",!1,!1,!1).subscribe((function(t){e.deliveryArrConstantes={cantItemsScala:t.data[0].value,costoScala:t.data[1].value},localStorage.setItem("sys::ICS",btoa(JSON.stringify(e.deliveryArrConstantes)))}))}},{key:"addItem2",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=parseInt(t.cantidad.toString(),0),s=0===i;if(!(o<=0&&s)){var a=e.cantidad_seleccionada||0;if(!((a+=s?1:-1)<0)){"ND"!==t.isporcion&&(a=a<0?0:a,o=(o+=s?-1:1)<0||a<0?0:o),a=a<0?0:a,e.cantidad_seleccionada=a;var c=JSON.parse(JSON.stringify(e)),r=this.findItemMiPedido(c,this.mpObjSeccionSelected,t,s);r.cantidad=o,t=n?this.findItemCarta(t):t,(t=this.findItemCarta(t)).sumar=s,t.subitems_selected=r.subitems_selected,t.subitems_view=r.subitems_view;var u=this.findItemListPedido(t),d=1;u?(u.itemtiposconsumo||(u.itemtiposconsumo=this.mpObjItemTipoConsumoSelected),d=this.totalItemTpcSelected(u.itemtiposconsumo)||0,u.cantidad_seleccionada=d,u.subitems_selected=r.subitems_selected,u.subitems_view=r.subitems_view):this.listItemsPedido.push(t),t.cantidad_seleccionada=d,this.itemStockChangeSource.next(t),this.setLocalStorageHora(),this.setLocalStoragePedido(),this.socketService.emit("itemModificado",t),this.listenStatusService.setHayPedidoPendiente(!0),this.playTimerLimit()}}}},{key:"totalItemTpcSelected",value:function(e){return e.map((function(e){return e.cantidad_seleccionada||0})).reduce((function(e,t){return e+t}),0)}},{key:"addCantItemMiPedido",value:function(e,t){var i=t,n=i*parseFloat(e.precio_unitario);e.subitems_selected&&e.subitems_selected.map((function(e){return e.precio*e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0),e.cantidad_seleccionada=i,e.precio_total=n,e.precio_print=n}},{key:"addPrecioItemMiPedido",value:function(e){var t=e.subitems_view?e.subitems_view.map((function(e){return e.precio})).reduce((function(e,t){return e+t}),0):0,i=e.cantidad_seleccionada*parseFloat(e.precio_unitario);i+=t,e.precio_total=i,e.precio_print=i}},{key:"addItemSubItemMiPedido",value:function(e,t,i){var n=this;if(e.subitems){if(0===e.subitems.length)return;var o=new S;if(o.id="",o.des="",o.listDes=[],o.cantidad_seleccionada=0,o.precio=0,o.indicaciones="",o.subitems=[],e.subitems_selected&&e.subitems_selected.length>0){e.subitems_selected.map((function(e){o.id+=e.iditem_subitem.toString(),o.listDes.push(n.utilesService.primeraConMayusculas(e.des.toLowerCase())),o.cantidad_seleccionada=1,o.precio+=parseFloat(e.precio.toString()),o.subitems.push(e)})),o.des=o.listDes.join(", "),o.des+=void 0===e.indicaciones||""===e.indicaciones?"":", ("+e.indicaciones+")",e.indicaciones="",e.subitems_view=e.subitems_view?e.subitems_view:[];var s=e.subitems_view.filter((function(e){return e.id===o.id}))[0];s?i?(s.indicaciones+=o.indicaciones,s.cantidad_seleccionada+=1,s.precio+=o.precio):this.restarCantSubItemView(e,s):i?e.subitems_view.push(o):this.restarCantSubItemView(e,null),this.addPrecioItemMiPedido(e)}}}},{key:"restarCantSubItemView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){var i=t.precio/t.cantidad_seleccionada;t.cantidad_seleccionada-=1,t.precio-=i,t.precio=t.precio<0?0:t.precio,t.cantidad_seleccionada<=0&&(e.subitems_view=e.subitems_view.filter((function(e){return e.cantidad_seleccionada>0})))}else{var n=e.subitems_view[e.subitems_view.length-1],o=n.precio/n.cantidad_seleccionada;n.cantidad_seleccionada--,n.precio-=o,n.cantidad_seleccionada<=0&&(e.subitems_view=e.subitems_view.filter((function(e){return e.cantidad_seleccionada>0}))),e.subitems_selected=n.subitems}}},{key:"addItemInCarta",value:function(e){var t=this.findItemCarta(e);t?t.cantidad=t.cantidad:this.objCarta.carta.map((function(t){t.secciones.filter((function(t){return t.idseccion===e.idseccion})).map((function(t){t.items.push(e)}))}))}},{key:"findItemFromArr",value:function(e,t){return e.filter((function(e){return e.iditem===t.iditem}))[0]}},{key:"findItemListPedido",value:function(e){return this.listItemsPedido.filter((function(t){return t.iditem===e.iditem}))[0]}},{key:"findItemCartaAndClearIndicaciones",value:function(){this.objCarta.carta.map((function(e){e.secciones.map((function(e){e.items.filter((function(e){return e.indicaciones})).map((function(e){return e.indicaciones=""})),e.items.filter((function(e){return e.subitems_selected})).map((function(e){return e.subitems_selected=null})),e.items.filter((function(e){return e.subitems_view})).map((function(e){return e.subitems_view=null}))}))}))}},{key:"findItemCarta",value:function(e){var t;return this.objCarta.carta.map((function(i){i.secciones.map((function(i){var n=i.items.filter((function(t){return t.idcarta_lista===e.idcarta_lista}))[0];if(n)return t=n}))})),t}},{key:"findItemCartaByIdCartaLista",value:function(e){var t;return this.objCarta.carta.map((function(i){i.secciones.map((function(i){var n=i.items.filter((function(t){return t.idcarta_lista.toString()===e.toString()}))[0];if(n)return t=n}))})),t}},{key:"findSubItemCartaById",value:function(e,t){var i=[];return this.objCarta.carta.map((function(n){n.secciones.map((function(n){n.items.filter((function(e){return e.iditem.toString()!==t})).filter((function(e){return e.subitems})).map((function(t){t.subitems.map((function(t){var n=t.opciones.filter((function(t){return t.idproducto.toString()+t.idporcion.toString()===e}))[0];n&&i.push(n)}))}))}))})),i}},{key:"resetCantidadesTpcItemCarta",value:function(){this.objCarta&&this.objCarta.carta.map((function(e){e.secciones.map((function(e){e.items.map((function(e){e.indicaciones="",e.cantidad_seleccionada=0,e.itemtiposconsumo=null}))}))}))}},{key:"findItemSeccionCarta",value:function(e){var t;return this.objCarta.carta.map((function(i){var n=i.secciones.filter((function(t){return t.idseccion===e}))[0];n&&(t=n)})),t}},{key:"findOnlyItemMiPedido",value:function(e){var t;return this.miPedido.tipoconsumo.map((function(i){i.secciones.map((function(i){t=i.items.filter((function(t){return t.idcarta_lista===e.idcarta_lista}))[0]}))})),t}},{key:"findItemMiPedido",value:function(e,t,i,n){var o,s=JSON.parse(JSON.stringify(i)),a=e.cantidad_seleccionada;s.itemtiposconsumo=[],this.addCantItemMiPedido(s,a);var c=this.miPedido.tipoconsumo.filter((function(t){return t.idtipo_consumo===e.idtipo_consumo}))[0];if(c){var r=c.secciones.filter((function(e){return e.idseccion===t.idseccion}))[0];if(r){var u=r.items.filter((function(e){return e.idcarta_lista===i.idcarta_lista}))[0];u?(u.indicaciones=s.indicaciones,this.addCantItemMiPedido(u,a),o=s=u):(r.items.push(s),o=s),s.subitems=i.subitems,s.subitems_selected=i.subitems_selected,this.addItemSubItemMiPedido(s,i,n),this.setCountCantItemTpcAndSeccion(c,r)}else{o=s;var d=JSON.parse(JSON.stringify(t));d.items=[],d.items.push(s),c.secciones=c.secciones?c.secciones:[],c.secciones.push(d),this.addItemSubItemMiPedido(s,i,n),this.setCountCantItemTpcAndSeccion(c,d)}}else{s.subitems=i.subitems,s.subitems_selected=i.subitems_selected,this.addItemSubItemMiPedido(s,i,n);var m=JSON.parse(JSON.stringify(t));m.items=[],m.items.push(s),e.secciones=e.secciones?e.secciones:[],e.secciones.push(m),this.miPedido.tipoconsumo.push(e),this.setCountCantItemTpcAndSeccion(e,m),o=s}return this.clearObjMiPedido(),o}},{key:"quitarTpcMiPedido",value:function(e){1===e.count_items_seccion&&(this.miPedido.tipoconsumo=this.miPedido.tipoconsumo.filter((function(t){return!e})))}},{key:"quitarSeccionMiPedido",value:function(e){1===e.count_items&&this.miPedido.tipoconsumo.map((function(t){t.secciones.filter((function(t){return!e}))}))}},{key:"findMiPedidoIsTPCLocal",value:function(){var e=!1;return this.miPedido.tipoconsumo.filter((function(e){return"LOCAL"===e.titulo})).map((function(t){e=!!t.secciones.filter((function(e){return e.count_items>0}))[0]})),e}},{key:"findMiPedidoIsTPCDelivery",value:function(){var e=!1;return this.miPedido.tipoconsumo.filter((function(e){return"DELIVERY"===e.descripcion.toUpperCase()})).map((function(t){e=!!t.secciones.filter((function(e){return e.count_items>0}))[0]})),e}},{key:"findMiPedidoIsTPCLLevar",value:function(){var e=!1;return this.miPedido.tipoconsumo.filter((function(e){return e.descripcion.toUpperCase().indexOf("LLEVAR")})).map((function(t){e=!!t.secciones.filter((function(e){return e.count_items>0}))[0]})),e}},{key:"findEvaluateTPCMiPedido",value:function(){var e=new h,t=0;return this.miPedido.tipoconsumo.filter((function(e){return e.count_items_seccion>0})).map((function(i){"LOCAL"===i.titulo&&(e.isTpcLocal=!0,t++),i.descripcion.toUpperCase().indexOf("LLEVAR")>-1&&(e.isTpcSoloLLevar=!0,t++),i.descripcion.toUpperCase().indexOf("DELIVERY")>-1&&(e.isTpcSoloDelivery=!0),e.isRequiereMesa=!!e.isTpcLocal,e.isTpcSoloLLevar=!(1!==t||!e.isTpcSoloLLevar)})),e}},{key:"findSeccionInMipedidoByPrint",value:function(e){var t;return this.miPedido.tipoconsumo.map((function(i){t=i.secciones.filter((function(t){return t.idimpresora===e}))})),t}},{key:"findIsHayItems",value:function(){return this.setCountTotalImtesPedido()>0}},{key:"clearObjMiPedido",value:function(){if(this.miPedido.tipoconsumo=this.miPedido.tipoconsumo.filter((function(e){return e.count_items_seccion>0})),0===this.miPedido.tipoconsumo.length)return this.miPedido=new a.a,void this.miPedidoSource.next(this.miPedido);this.miPedido.tipoconsumo=this.miPedido.tipoconsumo.map((function(e){return e.secciones=e.secciones.filter((function(e){return e.count_items>0})),e})),this.miPedido.tipoconsumo=this.miPedido.tipoconsumo.map((function(e){return e.secciones=e.secciones.map((function(e){return e.items=e.items.filter((function(e){return e.cantidad_seleccionada>0})),e})),e})),this.miPedidoSource.next(this.miPedido)}},{key:"setCountCantItemTpcAndSeccion",value:function(e,t){var i=t.items.map((function(e){return e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0);t.count_items=i;var n=e.secciones.map((function(e){return e.count_items})).reduce((function(e,t){return e+t}),0);e.count_items_seccion=n,this.setCountTotalImtesPedido()}},{key:"setCountTotalImtesPedido",value:function(){var e=this.miPedido.tipoconsumo.map((function(e){return e.count_items_seccion})).reduce((function(e,t){return e+t}),0);return this.countItemsSource.next(e),e}},{key:"setLocalStorageHora",value:function(){if(!this.storageService.isExistKey("sys::h")){var e="".concat(this.time.getHours(),":").concat(this.time.getMinutes(),":").concat(this.time.getSeconds());this.storageService.set("sys::h",e.toString())}}},{key:"setLocalStoragePedido",value:function(){this.storageService.set("sys::order",btoa(JSON.stringify(this.listItemsPedido))),this.storageService.set("sys::order::all",btoa(JSON.stringify(this.miPedido)))}},{key:"clearPedidoIsLimitTime",value:function(){this.storageService.isExistKey("sys::order")&&(this.listItemsPedido=JSON.parse(atob(this.storageService.get("sys::order"))),this.miPedido=JSON.parse(atob(this.storageService.get("sys::order::all"))))}},{key:"resetAllNewPedido",value:function(){this.socketService.emit("resetPedido",this.listItemsPedido),this.prepareNewPedido()}},{key:"prepareNewPedido",value:function(){this.resetTpcCarta(),this.storageService.clear("sys::h"),this.storageService.clear("sys::order"),this.storageService.clear("sys::order::all"),this.storageService.clear("sys::tcount"),this.storageService.clear("sys::tnum"),this.miPedido=null,this.miPedido=new a.a,this.miPedidoSource.next(this.miPedido),this.countItemsSource.next(0),this.listenStatusService.setHayPedidoPendiente(!1),this.stopTimerLimit()}},{key:"getOnlyCarta",value:function(){this.socketService.emit("getOnlyCarta",null)}},{key:"resetTpcCarta",value:function(){var e=this;try{this.listItemsPedido.map((function(t){if(t.indicaciones="",t.itemtiposconsumo){t.itemtiposconsumo=null;var i=e.findItemCarta(t);i.indicaciones="",i.cantidad_seleccionada=0,i.itemtiposconsumo=null}}))}catch(t){}this.resetCantidadesTpcItemCarta(),this.listItemsPedido=[]}},{key:"updatePedidoFromStrorage",value:function(){var e=this;this.listenStatusService.setHayPedidoPendiente(!1),this.storageService.isExistKey("sys::order")&&(this.listenStatusService.setHayPedidoPendiente(!0),this.listItemsPedido=JSON.parse(atob(this.storageService.get("sys::order"))),this.miPedido=JSON.parse(atob(this.storageService.get("sys::order::all"))),this.setCountTotalImtesPedido(),this.miPedidoSource.next(this.miPedido),this.listItemsPedido.map((function(t){e.objCarta.carta.map((function(e){e.secciones.map((function(e){var i=e.items.filter((function(e){return e.idcarta_lista===t.idcarta_lista}))[0];i&&(i.cantidad_seleccionada=t.cantidad_seleccionada,i.itemtiposconsumo=t.itemtiposconsumo)}))}))})))}},{key:"updatePedidoFromClear",value:function(){var e=this;this.listItemsPedido&&(this.listItemsPedido.map((function(t){0===t.isalmacen&&e.objCarta.carta.map((function(e){e.secciones.map((function(e){var i=e.items.filter((function(e){return"ND"!==e.isporcion&&e.idcarta_lista===t.idcarta_lista}))[0];i&&(i.cantidad=parseInt(i.cantidad.toString(),0)+t.cantidad_seleccionada)}))}))})),this.prepareNewPedido())}},{key:"getEstadoStockItem",value:function(e){return e>10?"verde":e>5?"amarillo":"rojo"}},{key:"validarReglasCarta",value:function(e){var t=this,i=0,n=0,o=0,s=0,a=0,c=0,r=0;this.miPedido.tipoconsumo.map((function(e){e.secciones.map((function(e){e.items.map((function(e){return e.precio_total_calc=null}))}))})),e.map((function(e){i=e.idseccion,n=e.idseccion_detalle,o=t.countCantItemsFromSeccion(i),s=t.countCantItemsFromSeccion(n),a=(a=o-s)<0?o:a,t.miPedido.tipoconsumo.map((function(e){e.secciones.filter((function(e){return e.idseccion.toString()===n.toString()})).map((function(e){e.items.map((function(e,t){var i=parseFloat(e.precio),n=e.cantidad_seleccionada;r=null!==e.precio_total_calc?e.precio_total_calc:e.precio_total,c=r,o>=s?c=0:a>0&&(c=(c=r-(c=a*i))<0?0:c,a=a-n<0?0:a-n),e.precio_total_calc=parseFloat(c.toString()),e.precio_print=parseFloat(c.toString()),e.cantidad_descontado=n}))}))}))}))}},{key:"countCantItemsFromSeccion",value:function(e){var t=0;return this.miPedido.tipoconsumo.map((function(i){i.secciones.map((function(i){t+=i.items.filter((function(t){return t.idseccion.toString()===e.toString()})).map((function(e){return e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0)}))})),t}},{key:"countCantItemsFromTpcSeccion",value:function(e,t){var i=0;return this.miPedido.tipoconsumo.filter((function(t){return t.idtipo_consumo.toString()===e.toString()})).map((function(e){e.secciones.map((function(e){i+=e.items.filter((function(e){return e.idseccion.toString()===t.toString()})).map((function(e){return e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0)}))})),i}},{key:"countCantItemsFromTpc",value:function(e){var t=0;return this.miPedido.tipoconsumo.filter((function(t){return t.idtipo_consumo.toString()===e.toString()})).map((function(e){e.secciones.map((function(e){t+=e.items.map((function(e){return e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0)}))})),t}},{key:"countCantItemsFromTpcDes",value:function(e){var t=0;return this.miPedido.tipoconsumo.filter((function(t){return t.descripcion.toLowerCase()===e.toLowerCase()})).map((function(e){e.secciones.map((function(e){t+=e.items.map((function(e){return e.cantidad_seleccionada})).reduce((function(e,t){return e+t}),0)}))})),t}},{key:"getArrSubTotales",value:function(e){var t=this,i=this.getSubTotalMiPedido(),n=1===this.establecimientoService.establecimiento.pwa_delivery_hablitar_calc_costo_servicio,o=this.establecimientoService.establecimiento.pwa_delivery_comision_fija_no_afiliado,s=1===this.establecimientoService.establecimiento.pwa_delivery_comercio_paga_entrega;this.pwa_delivery_servicio_propio=1===this.establecimientoService.establecimiento.pwa_delivery_servicio_propio;var a=i,c=[],r={id:0,descripcion:"SUB TOTAL",esImpuesto:0,visible:!0,quitar:!1,tachado:!1,visible_cpe:!0};r.importe=parseFloat(i.toString()).toFixed(2),c.push(r);var u=[];e.filter((function(e){return"p"===e.tipo})).map((function(e){var t=e.monto/100,n=1===e.es_impuesto,o=0===e.activo,s=(i*t).toFixed(2),c={};c.id=e.tipo+e.id,c.descripcion=e.descripcion,c.esImpuesto=e.es_impuesto,c.visible=!0,c.quitar=!1,c.tachado=!1,c.visible_cpe=n,"I.G.V"===c.descripcion?(c.importe=o?t:0,u.push(c)):(c.importe=n?o?s:0:s,c.importe=parseFloat(c.importe.toString()).toFixed(2),a+=parseFloat(c.importe)),0!==c.importe&&u.push(c)}));var d=0,m=[],l=e.filter((function(e){return"a"===e.tipo})),p=!this.infoTokenService.infoUsToken.idusuario,f=!1,v=this.countCantItemsFromTpcDes("delivery")+this.countCantItemsFromTpcDes("entrega")+this.countCantItemsFromTpcDes("cantidad");if(f=v>0,d=this.establecimientoService.get().c_servicio||this.establecimientoService.get().c_minimo,l.map((function(e){var i={};if((e.descripcion.toUpperCase().indexOf("DELIVERY")>-1||e.descripcion.toUpperCase().indexOf("ENTREGA")>-1)&&p){if(e.descripcion="Entrega",!t.pwa_delivery_servicio_propio||n){f=!0,d=t.establecimientoService.get().c_servicio||t.establecimientoService.get().c_minimo;var o=t.countCantItemsFromTpc(e.idtipo_consumo);return void(p=o>0)}d=parseFloat(e.monto)}else d=parseFloat(e.monto);if(0!==t.countCantItemsFromTpc(e.idtipo_consumo)){if(0===e.nivel){var s=t.countCantItemsFromTpcSeccion(e.idtipo_consumo,e.idseccion);if(0===s)return;var c=t.calcCostoCantItemsDelivery();d=s*parseFloat(e.monto)+c}i.id=e.tipo+e.id,i.descripcion=e.descripcion,i.esImpuesto=e.es_impuesto,i.visible=!0,i.quitar=!0,i.tachado=!1,i.visible_cpe=!1,i.importe=parseFloat(d.toString()).toFixed(2),a+=parseFloat(i.importe);var r=m.filter((function(e){return e.descripcion===i.descripcion}))[0];r?r.importe+=parseFloat(i.importe):m.push(i)}})),f){var h={},S=this.calcCostoCantItemsDelivery()+(this.establecimientoService.get().c_servicio||this.establecimientoService.get().c_minimo)+o;this.establecimientoService.setCostoSercioDelivery(S),!s&&n&&(h.id=-2,h.descripcion="Entrega",h.esImpuesto=0,h.visible=!0,h.quitar=!1,h.tachado=!1,h.visible_cpe=!1,h.importe=parseFloat(S.toString()).toFixed(2),a+=parseFloat(h.importe),m.push(h))}u.map((function(e){return c.push(e)})),m.map((function(e){return c.push(e)}));var b=c.filter((function(e){return"SUB TOTAL"===e.descripcion}))[0],_=c.filter((function(e){return"I.G.V"===e.descripcion}))[0],y=_?_.importe:0,g=b?b.importe:0;return y>0&&(g-=y=parseFloat((g*y).toString()).toFixed(2),_.importe=y,b.importe=g.toFixed(2)),(r={}).id=0,r.esImpuesto=0,r.descripcion="TOTAL",r.visible=!0,r.quitar=!1,r.tachado=!1,r.visible_cpe=!0,r.importe=parseFloat(a.toString()).toFixed(2),c.push(r),c}},{key:"calcCostoCantItemsDelivery",value:function(){var e=0,t=parseInt(this.deliveryArrConstantes.cantItemsScala.toString(),0);if(this.deliveryCanItemsInOrder>t){var i=this.deliveryCanItemsInOrder/this.deliveryArrConstantes.cantItemsScala;i>1&&(e=Math.floor(i)*this.deliveryArrConstantes.costoScala)}else e=0;return e}},{key:"getSubTotalMiPedido",value:function(){var e=0,t=0;return this.miPedido.tipoconsumo.map((function(i){i.secciones.map((function(i){e+=i.items.map((function(e){return t+=e.cantidad_seleccionada,e.precio_print})).reduce((function(e,t){return e+t}),0)}))})),this.deliveryCanItemsInOrder=t,e}},{key:"getImporteTotalItemFromMiPedido",value:function(e){var t=0;return this.miPedido.tipoconsumo.map((function(i){i.secciones.map((function(i){t+=i.items.filter((function(t){return t.iditem===e.iditem})).map((function(e){return e.precio_print})).reduce((function(e,t){return e+t}),0)}))})),t}},{key:"playTimerLimit",value:function(){this.timerLimitService.playCountTimerLimit()}},{key:"stopTimerLimit",value:function(){this.timerLimitService.resetCountTimerLimit()}},{key:"restoreTimerLimit",value:function(){this.timerLimitService.resetCountTimerLimit()}},{key:"listenChangeCantItem",value:function(){var e=this;this.socketService.onItemModificado().subscribe((function(t){var i;null!=t.listItemPorcion?t.listItemPorcion.map((function(n){i=e.findItemCartaByIdCartaLista(n.idcarta_lista);var o=parseInt(n.cantidad,0);i.cantidad=o||parseInt(t.item.cantidad.toString(),0),e.setCantidadItemModificadoPwa(t.item,i,parseInt(n.cantidad,0),!0)})):(i=e.findItemCarta(t=t.item),e.setCantidadItemModificadoPwa(t,i))})),this.socketService.onItemResetCant().subscribe((function(t){var i;null!=t.listItemPorcion?t.listItemPorcion.map((function(n){(i=e.findItemCartaByIdCartaLista(n.idcarta_lista)).cantidad=parseInt(n.cantidad,0),e.setCantidadItemModificadoPwa(t.item,i,parseInt(n.cantidad,0),!0),e.itemStockChangeSource.next(i)})):((i=e.findItemCarta(t=t.item)).cantidad=parseInt(t.cantidad.toString(),0),i.subitems=t.subitems,e.itemStockChangeSource.next(i))})),this.socketService.onNuevoItemAddInCarta().subscribe((function(t){e.addItemInCarta(t)})),this.socketService.onGetDatosSede().subscribe((function(t){e.objDatosSede=t[0],e.objDatosSede.datossede[0].longitude=parseFloat(e.objDatosSede.datossede[0].longitude),e.objDatosSede.datossede[0].latitude=parseFloat(e.objDatosSede.datossede[0].latitude),e.listenStatusService.setHayDatosSede(!0),localStorage.setItem("sys::s",e.objDatosSede.datossede[0].nombre+"|"+e.objDatosSede.datossede[0].ciudad),e.max_minute_order=t[0].datossede[0].pwa_time_limit,e.pwa_delivery_servicio_propio=0!==t[0].datossede[0].pwa_delivery_servicio_propio,e.timerLimitService.maxTime=100*e.max_minute_order})),this.timerLimitService.countdown$.subscribe((function(t){switch(t){case 1:e.isPreAvisoVisible=!1;break;case 80:e.isPreAvisoVisible||(e.isPreAvisoVisible=!0,e._snackBar.open("Proximo a cumplir el tiempo de envio.","",{duration:2e3}));break;case 100:e._snackBar.open("Tiempo agotado, debe realizar un nuevo pedido.","",{duration:3e3})}})),this.timerLimitService.isTimeLimitComplet$.subscribe((function(t){!0===t&&(e.resetAllNewPedido(),e.navigatorService.setPageActive("carta"))}))}},{key:"setCantidadItemModificadoPwa",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.subitems&&e.idcarta_lista===t.idcarta_lista&&e.subitems.map((function(n){n.opciones.map((function(n){t.subitems.map((function(t){var o=t.opciones.filter((function(e){return e.iditem_subitem===parseInt(n.iditem_subitem.toString(),0)}))[0];if(o&&"ND"!==o.cantidad){o.cantidad=n.cantidad;var s=o.idproducto.toString()+o.idporcion.toString();i.findSubItemCartaById(s,e.iditem.toString()).map((function(e){e.cantidad=n.cantidad}))}}))}))})),o||(t.cantidad=n||parseInt(e.cantidad.toString(),0)),this.itemStockChangeSource.next(t)}},{key:"darFormatoPedido",value:function(e){var t=new a.a,i=[];return e.data.map((function(e){var t=i.filter((function(t){return t.idtipo_consumo===e.idtipo_consumo}))[0];t||((t=new u.a).descripcion=e.des_tp,t.idtipo_consumo=parseInt(e.idtipo_consumo,0),i.push(t))})),i.map((function(t){e.data.filter((function(e){return e.idtipo_consumo===t.idtipo_consumo})).map((function(e,i){var n=t.secciones.filter((function(t){return t.idseccion.toString()===e.idseccion.toString()}))[0];n||((n=new r.a).idseccion=e.idseccion.toString(),n.des=e.des_seccion,n.sec_orden=e.sec_orden,n.ver_stock_cero=0,t.count_items_seccion=i+1,t.secciones.push(n))}))})),i.map((function(t){t.secciones.map((function(i){e.data.filter((function(e){return e.idtipo_consumo.toString()===t.idtipo_consumo.toString()&&e.idseccion.toString()===i.idseccion.toString()})).map((function(e,t){var n=new s.a;n.des=e.descripcion,n.detalles="",n.iditem=e.iditem,n.idcarta_lista=e.idcarta_lista,n.idseccion=e.idseccion,n.isalmacen=e.isalmacen,n.cantidad_seleccionada=parseInt(e.cantidad,0),n.precio=e.punitario,n.precio_print=parseFloat(e.ptotal),n.precio_total=parseFloat(e.ptotal),n.procede="0"===e.procede?1:0,n.seccion=e.des_seccion,n.img=e.img,n.subitems_view="null"!==e.subitems&&""!==e.subitems&&e.subitems?JSON.parse(e.subitems):[],i.count_items=t+1,i.items=i.items?i.items:[],i.items.push(n)}))}))})),t.tipoconsumo=i,t}},{key:"cerrarSession",value:function(){this.socketService.closeConnection(),this.navigatorService.cerrarSession()}}]),e}()).\u0275fac=function(e){return new(e||n)(g.Vb(d.a),g.Vb(m.a),g.Vb(l.a),g.Vb(p.a),g.Vb(C.a),g.Vb(f.a),g.Vb(v.a),g.Vb(b.a),g.Vb(_.a),g.Vb(y.a))},n.\u0275prov=g.Hb({token:n,factory:n.\u0275fac,providedIn:"root"}),n)},qTE5:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function e(){_classCallCheck(this,e)}},"wne+":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("fXoL"),o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"primeraConMayusculas",value:function(e){return(e=e.toLowerCase()).charAt(0).toUpperCase()+e.slice(1)}},{key:"reformatDate",value:function(e){var t=e.split("-");return t[2]+"/"+t[1]+"/"+t[0]}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()}}]);