{"version":3,"sources":["src/assets/js/boton-pago.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qE;AACA;;AAEA;;;AAGA;AACA,uD;AACA;AACA;AACA,sEAAsE;AACtE;;AAEA;AACA,yC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA,6C;AACA;AACA,GAAG;AACH;;AAEA,mC;AACA,qB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qD;;;AAGA;AACA,sC;AACA;AACA,wC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,mD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,e;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,2B;AACA;AACA,KAAK;AACL,uB;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;;AAEA,kD;AACA;AACA;;;AAGA;AACA,sC;AACA;AACA,yE;AACA,C","file":"scripts.js","sourcesContent":["var importe;\nvar purchasenumber;\nvar cargando_transaction = false;\nvar dataCliente;\n\n// 240120 - last update.\n// DESARROLLO\n// var user = \"integraciones.visanet@necomplus.com\";\n// var password = \"d5e7nk$M\";\n// var merchantId = '522591303';\n// var urlApiSeguridad = \"https://apitestenv.vnforapps.com/api.security/v1/security\";\n// var urlApiSesion = \"https://apitestenv.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/\";\n// var urlApiAutorization =  \"https://apitestenv.vnforapps.com/api.authorization/v3/authorization/ecommerce/\";\n// var urlJs = \"https://static-content-qas.vnforapps.com/v2/js/checkout.js?qa=true\";\n// var logo = 'http://web-p.test:8080/images/l-pay-2.png';\n\n// aW50ZWdyYWNpb25lcy52aXNhbmV0QG5lY29tcGx1cy5jb206ZDVlN25rJE0=\n\n\n// PROD\nvar user = \"macraze.info@gmail.com\";\nvar password = \"j34Oz!nB\";\nvar merchantId = '650149801';\nvar urlApiSeguridad = \"https://apiprod.vnforapps.com/api.security/v1/security\";\nvar urlApiSesion = \"https://apiprod.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/\";\nvar urlApiAutorization =  \"https://apiprod.vnforapps.com/api.authorization/v3/authorization/ecommerce/\";\nvar urlJs = \"https://static-content.vnforapps.com/v2/js/checkout.js\"; \nvar logo = 'https://papaya.com.pe/images/l-pay-2.png';\n\n// bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg==\n\n\nfunction pagar(_importe, _purchasenumber, _dataClie) {\n  importe = parseFloat(_importe).toFixed(2).toString();  \n  purchasenumber = _purchasenumber;\n  dataCliente = _dataClie;\n  // dataCliente.email_token = dataCliente.idcliente +'@apitoken.com'; // para guardar las tarjetas - userToken\n  dataCliente.email_token = dataCliente.email;\n  \n  loaderTransaction(0);\n  loaderTransactionResponse(null, false);  \n  getIpCliente();\n  // generarToken();\n}\n\nfunction getIpCliente() {\n\n  // antifraude\n  dataCliente.antifraud = {\n    \"clientIp\": dataCliente.ip,\n    \"merchantDefineData\":{\n      \"MDD4\": dataCliente.email,            \n      \"MDD32\": dataCliente.idcliente,\n      \"MDD75\": \"Invitado\",\n      \"MDD77\": dataCliente.diasRegistrado,\n      \"MDD89\": \"1\"\n      // \"MDD70\": \"1\", // correo electronico confirmado\n    }\n  };\n  generarToken();\n}\n\n\nfunction generarToken() {\n  var settings = {\n    \"async\": true,\n    \"crossDomain\": true,\n    \"url\": urlApiSeguridad,\n    \"method\": \"POST\",\n    \"headers\": {\n      \"Authorization\": \"Basic bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg==\",\n      \"Accept\": \"*/*\"\n    }\n  };\n\n  $.ajax(settings).done(function (response) {\n    // console.log(response);\n    generarSesion(response);\n    localStorage.setItem(\"token\", response);\n  });\n}\n\nfunction generarSesion(token) {\n  // console.log('importe: ', importe);\n\n  var data = {\n    \"amount\": importe,\n    \"antifraud\": null,\n    \"channel\": \"web\",\n    \"recurrenceMaxAmount\": null\n  };\n\n  var settings = {\n    \"async\": true,\n    \"crossDomain\": true,\n    \"url\": urlApiSesion + merchantId,\n    \"method\": \"POST\",\n    \"headers\": {\n      \"Authorization\": token,\n      \"Content-Type\": \"application/json\",\n    },\n    \"dataMap\": {\n      \"userToken\": dataCliente.email\n    },\n    \"processData\": false,\n    \"data\": JSON.stringify(data)\n  };\n\n  $.ajax(settings).done(function (response) {    \n    generarBoton(response['sessionKey']);\n  });\n}\n\nfunction generarBoton(sessionKey) {  \n  var moneda = 'PEN';  \n  \n  /// DEV\n  // var nombre = 'Integraciones';\n  // var apellido = 'VisaNet';\n  // var email = 'integraciones.visanet@necomplus.com';\n  \n  // PROD\n  var nombre = dataCliente.nombre;\n  var apellido = dataCliente.apellido;\n  var email = dataCliente.email; \n\n  var json = {\n    \"merchantId\": merchantId,\n    \"moneda\": moneda,\n    \"nombre\": nombre,\n    \"apellido\": apellido,\n    \"importe\": importe,\n    \"email\": email\n  };\n\n  localStorage.setItem(\"data\", JSON.stringify(json));  \n  \n\n  var form = document.createElement(\"form\");\n  form.setAttribute('method', \"post\");      \n  form.setAttribute('action', 'javascript:responseForm(self)');\n  form.setAttribute('id', \"boton_pago\");  \n  document.getElementById(\"btn_pago\").appendChild(form);\n\n  var scriptEl = document.createElement('script');\n  scriptEl.setAttribute('src', urlJs);\n  scriptEl.setAttribute('data-sessiontoken', sessionKey);\n  scriptEl.setAttribute('data-channel', 'web');\n  scriptEl.setAttribute('data-merchantid', merchantId);\n  \n  scriptEl.setAttribute('data-purchasenumber', purchasenumber);\n  scriptEl.setAttribute('data-amount', importe);\n  \n  scriptEl.setAttribute('data-merchantlogo', logo);  \n    \n  scriptEl.setAttribute('data-expirationminutes', 8);\n  scriptEl.setAttribute('data-timeouturl', \"javascript:responseForm(self)\");\n\n  scriptEl.setAttribute('data-cardholdername', nombre);\n  scriptEl.setAttribute('data-cardholderlastname', apellido);\n  scriptEl.setAttribute('data-cardholderemail', email);\n  scriptEl.setAttribute('data-usertoken', email);\n\n  document.getElementById(\"boton_pago\").appendChild(scriptEl);\n\n  document.getElementById(\"btn-disabled\").classList.add(\"btn-hidden\");\n\n}\n\n\nfunction responseForm(event) {\n  // console.log('respuesta', event.message.args[0]);\n  loaderTransaction(1);\n\n  var data = this.message.args[0];\n  transactionToken  = data.token;\n  \n  generateAutorizacion(transactionToken);\n\n}\n\nfunction generateAutorizacion(transactionToken) {\n  cargando_transaction = true;\n  var token = localStorage.getItem(\"token\");\n  var  data = { \n        \"antifraud\" : dataCliente.antifraud,\n        \"captureType\" : \"manual\",\n        \"channel\" : \"web\",\n        \"countable\" : false,\n        \"order\" : {\n            \"amount\" : importe,\n            \"currency\" : \"PEN\",\n            \"purchaseNumber\" : purchasenumber,\n            \"tokenId\" : transactionToken,\n        }\n  };\n\n  var _url = urlApiAutorization + merchantId;\n\n  fetch(_url, {\n      method: 'POST',\n      headers: {\n        \"Authorization\": token,\n        \"Content-Type\": 'application/json'\n      },    \n      body: JSON.stringify(data)\n    })\n    .then((response) => {\n      return response.json();\n    })\n    .then((res) => {\n      // console.log(res);\n      var hayError = res.errorCode ? true : false;\n      loaderTransaction(0);            \n      loaderTransactionResponse(res, hayError);\n    })\n    .catch((error) => {      \n      loaderTransaction(0);\n      loaderTransactionResponse(error, true);\n      // console.log(error);\n    });\n\n}\n\n// 0 = false 1 = true;\nfunction loaderTransaction(val) {\n  localStorage.setItem('sys::transaction-load', val);\n}\n\nfunction loaderTransactionResponse(res, isError) {  \n  if ( res ) {\n    res.error = isError;\n\n\n    var elem = document.querySelector('#visaNetWrapper');\n    elem.parentNode.removeChild(elem); \n  }\n  localStorage.setItem('sys::transaction-response', JSON.stringify(res));   \n}"],"sourceRoot":"webpack:///"}