var importe,purchasenumber,dataCliente,cargando_transaction=!1,user="macraze.info@gmail.com",password="j34Oz!nB",merchantId="650149801",urlApiSeguridad="https://apiprod.vnforapps.com/api.security/v1/security",urlApiSesion="https://apiprod.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/",urlApiAutorization="https://apiprod.vnforapps.com/api.authorization/v3/authorization/ecommerce/",urlJs="https://static-content.vnforapps.com/v2/js/checkout.js",logo="https://papaya.com.pe/images/l-pay-2.png";function pagar(e,t,a){importe=parseFloat(e).toFixed(2).toString(),purchasenumber=t,(dataCliente=a).email_token=dataCliente.email,loaderTransaction(0),loaderTransactionResponse(null,!1),getIpCliente()}function getIpCliente(){dataCliente.antifraud={clientIp:dataCliente.ip,merchantDefineData:{MDD4:dataCliente.email,MDD32:dataCliente.idcliente,MDD75:"Invitado",MDD77:dataCliente.diasRegistrado,MDD89:"1"}},generarToken()}function generarToken(){$.ajax({async:!0,crossDomain:!0,url:urlApiSeguridad,method:"POST",headers:{Authorization:"Basic bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg==",Accept:"*/*"}}).done((function(e){generarSesion(e),localStorage.setItem("token",e)}))}function generarSesion(e){var t={async:!0,crossDomain:!0,url:urlApiSesion+merchantId,method:"POST",headers:{Authorization:e,"Content-Type":"application/json"},dataMap:{userToken:dataCliente.email},processData:!1,data:JSON.stringify({amount:importe,antifraud:null,channel:"web",recurrenceMaxAmount:null})};$.ajax(t).done((function(e){generarBoton(e.sessionKey)}))}function generarBoton(e){var t=dataCliente.nombre,a=dataCliente.apellido,n=dataCliente.email;localStorage.setItem("data",JSON.stringify({merchantId:merchantId,moneda:"PEN",nombre:t,apellido:a,importe:importe,email:n}));var r=document.createElement("form");r.setAttribute("method","post"),r.setAttribute("action","javascript:responseForm(self)"),r.setAttribute("id","boton_pago"),document.getElementById("btn_pago").appendChild(r);var o=document.createElement("script");o.setAttribute("src",urlJs),o.setAttribute("data-sessiontoken",e),o.setAttribute("data-channel","web"),o.setAttribute("data-merchantid",merchantId),o.setAttribute("data-purchasenumber",purchasenumber),o.setAttribute("data-amount",importe),o.setAttribute("data-merchantlogo",logo),o.setAttribute("data-expirationminutes",8),o.setAttribute("data-timeouturl","javascript:responseForm(self)"),o.setAttribute("data-cardholdername",t),o.setAttribute("data-cardholderlastname",a),o.setAttribute("data-cardholderemail",n),o.setAttribute("data-usertoken",n),document.getElementById("boton_pago").appendChild(o),document.getElementById("btn-disabled").classList.add("btn-hidden")}function responseForm(e){loaderTransaction(1),transactionToken=this.message.args[0].token,generateAutorizacion(transactionToken)}function generateAutorizacion(e){cargando_transaction=!0;var t=localStorage.getItem("token");fetch(urlApiAutorization+merchantId,{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify({antifraud:dataCliente.antifraud,captureType:"manual",channel:"web",countable:!1,order:{amount:importe,currency:"PEN",purchaseNumber:purchasenumber,tokenId:e}})}).then(e=>e.json()).then(e=>{var t=!!e.errorCode;loaderTransaction(0),loaderTransactionResponse(e,t)}).catch(e=>{loaderTransaction(0),loaderTransactionResponse(e,!0)})}function loaderTransaction(e){localStorage.setItem("sys::transaction-load",e)}function loaderTransactionResponse(e,t){if(e){e.error=t;var a=document.querySelector("#visaNetWrapper");a.parentNode.removeChild(a)}localStorage.setItem("sys::transaction-response",JSON.stringify(e))}